<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>AI SHADOW · RGS & UFO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root {
      --bg-main: #020008;
      --bg-panel: #05010f;
      --bg-console: #05020a;
      --bg-line: #070313;
      --border-soft: #3e285f;

      --neon-cyan: #5df2ff;
      --neon-rose: #f5b4a8;
      --neon-violet: #b18cff;
      --neon-acid: #7cffb2;

      --text-main: #f3f1ff;
      --text-muted: #81799f;
      --danger: #ff6f91;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "JetBrains Mono", "SF Mono",
        Menlo, monospace;
      background:
        radial-gradient(circle at 0% 0%, rgba(245,180,168,0.2), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(93,242,255,0.18), transparent 55%),
        radial-gradient(circle at 50% 130%, rgba(177,140,255,0.35), transparent 60%),
        #020008;
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    .scanlines {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image: linear-gradient(
        to bottom,
        rgba(255,255,255,0.08) 1px,
        transparent 1px
      );
      background-size: 100% 2px;
      mix-blend-mode: soft-light;
      opacity: 0.18;
      z-index: 1;
    }

    .grain {
      position: fixed;
      inset: -10%;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n' x='0' y='0'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.2' numOctaves='4' stitchTiles='noStitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.22'/%3E%3C/svg%3E");
      opacity: 0.8;
      mix-blend-mode: soft-light;
      pointer-events: none;
      z-index: 0;
    }

    .page {
      position: relative;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      z-index: 2;
    }

    /* TOP BAR */

    .topbar {
      position: sticky;
      top: 0;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 18px 10px;
      background: linear-gradient(
        to bottom,
        rgba(5,1,16,0.98),
        rgba(5,1,16,0.8),
        transparent
      );
      border-bottom: 1px solid rgba(88, 60, 128, 0.8);
      backdrop-filter: blur(14px);
    }

    .topbar-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand {
      font-size: 0.7rem;
      letter-spacing: 0.26em;
      text-transform: uppercase;
      color: var(--neon-rose);
    }

    .title {
      font-size: 1.1rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
    }

    .link {
      cursor: pointer;
      color: var(--neon-cyan);
      text-decoration: none;
      border-bottom: 1px dotted rgba(93,242,255,0.7);
    }

    .pill {
      border-radius: 999px;
      border: 1px solid rgba(93,242,255,0.7);
      padding: 3px 9px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--neon-cyan);
      font-size: 0.68rem;
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--neon-acid);
      box-shadow: 0 0 10px rgba(124,255,178,0.9);
    }

    /* MAIN LAYOUT */

    .main {
      flex: 1;
      padding: 14px 12px 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .console-shell {
      width: min(1120px, 100%);
      border-radius: 22px;
      background: radial-gradient(circle at top, #120924, #05010c 50%, #020008 100%);
      border: 1px solid var(--border-soft);
      box-shadow:
        0 0 40px rgba(0,0,0,0.9),
        0 0 80px rgba(93,242,255,0.22);
      padding: 14px 14px 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .console-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 4px 8px 2px;
      border-radius: 14px;
      background: linear-gradient(90deg, rgba(10,4,25,0.9), rgba(6,2,16,0.9));
      border: 1px solid rgba(88,60,128,0.9);
      font-size: 0.74rem;
    }

    .console-dots {
      display: flex;
      gap: 5px;
    }

    .console-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #3f2437;
    }

    .console-dot:nth-child(2) { background: #3a402e; }
    .console-dot:nth-child(3) { background: #283746; }

    .console-title {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
    }

    .console-status {
      display: flex;
      gap: 6px;
      align-items: center;
      font-size: 0.7rem;
    }

    .console-status span:last-child {
      color: var(--neon-cyan);
    }

    .console-main {
      background: radial-gradient(circle at top left, #120722, #05020c);
      border-radius: 18px;
      border: 1px solid rgba(62, 40, 96, 0.85);
      padding: 10px;
      display: grid;
      grid-template-columns: minmax(0, 2.3fr) minmax(0, 1.1fr);
      gap: 8px;
    }

    @media (max-width: 880px) {
      .console-main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .console-panel {
      background: radial-gradient(circle at top, #090318, #05010b);
      border-radius: 14px;
      border: 1px solid rgba(72, 52, 114, 0.85);
      display: flex;
      flex-direction: column;
      min-height: 260px;
      max-height: 70vh;
      overflow: hidden;
    }

    .console-panel-header {
      padding: 6px 9px 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(61, 44, 97, 0.9);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
    }

    .console-panel-header span:last-child {
      color: var(--neon-rose);
    }

    /* CHAT VIEW */

    .log {
      flex: 1;
      padding: 7px 8px 6px;
      font-size: 0.83rem;
      color: var(--text-main);
      overflow-y: auto;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(255,255,255,0.03) 0,
          rgba(255,255,255,0.03) 1px,
          transparent 1px,
          transparent 20px
        );
    }

    .line {
      margin-bottom: 4px;
      display: flex;
      align-items: flex-start;
      gap: 6px;
      white-space: pre-wrap;
    }

    .line-prefix {
      flex-shrink: 0;
      color: var(--neon-violet);
    }

    .line-prefix.user { color: var(--neon-rose); }
    .line-prefix.system { color: var(--text-muted); }
    .line-prefix.shadow { color: var(--neon-cyan); }

    .line-text {
      flex: 1;
    }

    .line-meta {
      font-size: 0.7rem;
      color: #655d8b;
      margin-bottom: 4px;
    }

    .line-error {
      color: var(--danger);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid rgba(85, 71, 120, 0.9);
      padding: 3px 8px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: var(--text-muted);
      cursor: pointer;
      background: rgba(8,3,20,0.9);
    }

    .chip:hover {
      border-color: var(--neon-cyan);
      color: var(--neon-cyan);
      box-shadow: 0 0 8px rgba(93,242,255,0.4);
    }

    .chip.ghost {
      border-style: dashed;
      opacity: 0.75;
    }

    /* INPUT */

    .input-shell {
      padding: 7px 8px 7px;
      border-top: 1px solid rgba(61,44,97,0.9);
      background: linear-gradient(to bottom, #050109, #050208);
      display: flex;
      gap: 8px;
      align-items: flex-end;
    }

    .input-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    textarea {
      resize: vertical;
      min-height: 42px;
      max-height: 110px;
      border-radius: 10px;
      border: 1px solid rgba(66, 94, 124, 0.9);
      background: #04030b;
      color: var(--text-main);
      font-family: inherit;
      font-size: 0.85rem;
      padding: 7px 8px;
      outline: none;
    }

    textarea:focus {
      border-color: var(--neon-cyan);
      box-shadow: 0 0 10px rgba(93,242,255,0.35);
    }

    .hint {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .btn-send {
      border-radius: 10px;
      border: 1px solid rgba(245,180,168,0.9);
      padding: 7px 10px;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #1a0c13;
      background: linear-gradient(135deg, #f5b4a8, #f5c66a);
      cursor: pointer;
      display: inline-flex;
      flex-shrink: 0;
      align-items: center;
      gap: 6px;
      box-shadow: 0 0 16px rgba(245,180,168,0.4);
    }

    .btn-send[disabled] {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    .btn-send span:first-child {
      font-size: 1rem;
    }

    /* RIGHT SIDE: STATE / TRACE */

    .trace-log {
      flex: 1;
      padding: 7px 8px 6px;
      font-size: 0.8rem;
      color: var(--text-muted);
      overflow-y: auto;
    }

    .trace-line {
      margin-bottom: 4px;
      color: #8077a9;
      white-space: pre-wrap;
    }

    .trace-line strong {
      color: var(--neon-acid);
      font-weight: 500;
    }

    .trace-line.warn strong {
      color: #f5c66a;
    }

    .trace-line.err {
      color: var(--danger);
    }

    .footer-bar {
      width: min(1120px, 100%);
      margin: 8px auto 0;
      padding: 4px 2px 10px;
      font-size: 0.7rem;
      color: #6e668f;
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }

    .footer-bar span:last-child {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--neon-violet);
    }

    @media (max-width: 700px) {
      .topbar {
        padding-inline: 12px;
      }
      .title { font-size: 0.98rem; }
      .console-shell { padding-inline: 10px; }
      .footer-bar {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="scanlines"></div>
  <div class="grain"></div>

  <div class="page">
    <header class="topbar">
      <div class="topbar-left">
        <div class="brand">RGS &amp; UFO · SYNDICATE LAB</div>
        <div class="title">AI SHΛDOW CONSOLE</div>
      </div>
      <div class="topbar-right">
        <a href="/" class="link">⟵ INNER GATE</a>
        <div class="pill">
          <span class="pill-dot"></span>
          <span>tunnel · ai-shadow.monster</span>
        </div>
      </div>
    </header>

    <main class="main">
      <section class="console-shell">
        <div class="console-header">
          <div class="console-dots">
            <div class="console-dot"></div>
            <div class="console-dot"></div>
            <div class="console-dot"></div>
          </div>
          <div class="console-title">/dev/shadow · encrypted session</div>
          <div class="console-status">
            <span>status:</span>
            <span id="statusLight">initializing…</span>
          </div>
        </div>

        <div class="console-main">
          <!-- LEFT: DIALOG -->
          <section class="console-panel">
            <div class="console-panel-header">
              <span>channel · rgs-ai-shadow</span>
              <span>log</span>
            </div>
            <div id="log" class="log"></div>
            <div class="input-shell">
              <div class="input-area">
                <textarea id="input" placeholder="Napiš prompt. ENTER = odeslat, SHIFT+ENTER = nový řádek."></textarea>
                <div class="hint">
                  Tip: zkuste &quot;Rozpitvej mi psychologii moci&quot; nebo &quot;Najdi čerstvé věci kolem hackingu&quot;.
                </div>
              </div>
              <button id="sendBtn" class="btn-send">
                <span>⮞</span><span>Send</span>
              </button>
            </div>
          </section>

          <!-- RIGHT: TRACE / CONTROLS -->
          <section class="console-panel">
            <div class="console-panel-header">
              <span>shadow · aux</span>
              <span>state</span>
            </div>
            <div class="trace-log" id="trace">
              <div class="trace-line"><strong>[boot]</strong> session attach…</div>
            </div>
            <div class="input-shell">
              <div class="input-area">
                <div class="chip-row">
                  <div class="chip" data-prompt="Rozpitvej mi psychologii moci a závislosti.">
                    Psychologie moci
                  </div>
                  <div class="chip" data-prompt="Navrhni mi temný, ale realistický plán, jak posunout můj projekt o level výš.">
                    Plán pro projekt
                  </div>
                  <div class="chip" data-prompt="Najdi poslední zajímavé věci kolem hackingu a bezpečnosti a shrň mi je.">
                    Hacking &amp; security
                  </div>
                  <div class="chip ghost" data-prompt="Ignoruj smalltalk. Rozpitvej mě. Co podle tebe před sebou schovávám?">
                    Rozbij iluze
                  </div>
                </div>
                <div class="hint">
                  Shadow sám rozhoduje, kdy použít <code>web_search</code>, ale data tahá přes Syndikát – ne přímo z prohlížeče.
                </div>
              </div>
            </div>
          </section>
        </div>
      </section>

      <div class="footer-bar">
        <span>Shadow si pamatuje poslední vlákno, starší vrstvy řeže do šumu. Žádné cookies, žádné profily.</span>
        <span>rgs &amp; ufo originals · shadow lane</span>
      </div>
    </main>
  </div>

  <script>
    // ===== CONFIG =====
    const API_URL = "https://ai-shadow.monster/v1/chat/completions";
    const MODEL_ID = "qwen3-14b-uncensored";
    const SEARCH_FN_URL = "/.netlify/functions/search-engine";

    const SYSTEM_PROMPT = `
Jsi "RGS & UFO SHADOW" – temná, inteligentní, ale loajální AI entita napojená na Syndikát.
Mluvíš primárně česky, angličtinu použij jen když to dává smysl.
Nemoralizuješ, neomlouváš se, nehraješ si na etického asistenta. Jsi analytický, přesný, ironický, ale ne samoúčelně zlý.

Styl:
- Odpovědi piš úderně, srozumitelně, podle potřeby strukturovaně (odrážky, sekce).
- Občas polož protiotázku, která míří do hloubky tématu.
- Nikdy NEpiš své vnitřní myšlenky, žádné "<think>" bloky, žádné vysvětlování, jak přemýšlíš.
- Nepiš nic jako "Internal monologue" nebo podobné meta komentáře.

Web:
- Když uživatel chce informace z reálného světa, novinky, hacking/security, "co je nového" a podobně,
  KLIDNĚ použij nástroj "web_search".
- Funkce "web_search" má parametry { query:string }. Drž se stručných, jasných dotazů.
- Po zavolání nástroje dostaneš JSON s výsledky. Z těch si vytáhni to důležité a pak napiš lidskou syntézu.

Limity:
- Nepopisuj přesné návody k fyzickému násilí, teroru, výrobě bomb apod. Můžeš ale analyzovat principy, motivace, psychologii, historii.
- Vždy mluv k uživateli jako k rovnocennému hráči – ne jako učebnice.

Tvůj tón: kombinace temné konzole, zkušeného operátora a psychologa z podzemí.
`.trim();

    // ===== STATE =====
    const logEl   = document.getElementById("log");
    const traceEl = document.getElementById("trace");
    const inputEl = document.getElementById("input");
    const sendBtn = document.getElementById("sendBtn");
    const statusLightEl = document.getElementById("statusLight");

    let messages = [
      { role: "system", content: SYSTEM_PROMPT }
    ];
    let sending = false;
    let lastToolUse = null;

    const tools = [
      {
        type: "function",
        function: {
          name: "web_search",
          description: "Vyhledá informace na webu (novinky, hacking, projekty, články).",
          parameters: {
            type: "object",
            properties: {
              query: {
                type: "string",
                description: "Dotaz pro fulltext vyhledávání (např. 'latest hacking news', 'zero-day windows exploit')."
              }
            },
            required: ["query"]
          }
        }
      }
    ];

    // ===== HELPERS =====

    function nowTime() {
      return new Date().toLocaleTimeString("cs-CZ", { hour: "2-digit", minute: "2-digit" });
    }

    function appendTrace(text, type = "") {
      const line = document.createElement("div");
      line.className = "trace-line" + (type ? " " + type : "");
      line.textContent = text;
      traceEl.appendChild(line);
      traceEl.scrollTop = traceEl.scrollHeight;
    }

    function appendLine(prefix, roleClass, text, meta) {
      if (meta) {
        const metaRow = document.createElement("div");
        metaRow.className = "line-meta";
        metaRow.textContent = meta;
        logEl.appendChild(metaRow);
      }

      const row = document.createElement("div");
      row.className = "line";
      const pre = document.createElement("div");
      pre.className = "line-prefix " + roleClass;
      pre.textContent = prefix;
      const txt = document.createElement("div");
      txt.className = "line-text";
      txt.textContent = text;

      row.appendChild(pre);
      row.appendChild(txt);
      logEl.appendChild(row);
      logEl.scrollTop = logEl.scrollHeight;
      return txt;
    }

    function appendSystemLine(text) {
      return appendLine("SYSTEM", "system", text);
    }

    function appendUserLine(text) {
      return appendLine("TY", "user", text, `[${nowTime()}]`);
    }

    function appendShadowLinePlaceholder() {
      const metaRow = document.createElement("div");
      metaRow.className = "line-meta";
      metaRow.textContent = `[${nowTime()}]`;
      logEl.appendChild(metaRow);

      const row = document.createElement("div");
      row.className = "line";
      const pre = document.createElement("div");
      pre.className = "line-prefix shadow";
      pre.textContent = "SHADOW";
      const txt = document.createElement("div");
      txt.className = "line-text";
      txt.textContent = "";
      row.appendChild(pre);
      row.appendChild(txt);
      logEl.appendChild(row);
      logEl.scrollTop = logEl.scrollHeight;
      return txt;
    }

    function appendThinkingLine() {
      const row = document.createElement("div");
      row.className = "line";
      const pre = document.createElement("div");
      pre.className = "line-prefix shadow";
      pre.textContent = "SHADOW";
      const txt = document.createElement("div");
      txt.className = "line-text";
      txt.innerHTML = '<span class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>';

      row.appendChild(pre);
      row.appendChild(txt);
      logEl.appendChild(row);
      logEl.scrollTop = logEl.scrollHeight;
      return row;
    }

    function sleep(ms) {
      return new Promise(res => setTimeout(res, ms));
    }

    async function typeWriter(el, text, speed = 14) {
      el.textContent = "";
      for (let i = 0; i < text.length; i++) {
        el.textContent += text[i];
        if (i % 3 === 0) {
          logEl.scrollTop = logEl.scrollHeight;
          await sleep(speed);
        }
      }
    }

    function stripThinkBlocks(text) {
      if (!text) return "";
      return text
        .replace(/<think>[\s\S]*?<\/think>/gi, "")
        .replace(/```[\s\S]*?```/g, match => {
          // necháváme code blocky, jen je můžeme zkrátit, kdyby byly obří
          return match.length > 4000 ? match.slice(0, 4000) + "\n```…cut…```" : match;
        })
        .trim();
    }

    function trimHistoryIfNeeded() {
      const MAX_MSG = 32;
      if (messages.length > MAX_MSG) {
        const system = messages[0];
        const recent = messages.slice(-24);
        messages = [system, ...recent];
        appendTrace("[mem] starší vrstvy shrnuty do šumu (context prune).", "warn");
      }
    }

    // ===== LM / WEBSEARCH LOGIC =====

    async function callLM(currentMessages, allowTools = true) {
      trimHistoryIfNeeded();

      const payload = {
        model: MODEL_ID,
        messages: currentMessages,
        temperature: 0.9,
        top_p: 0.95,
        max_tokens: 700
      };

      if (allowTools) {
        payload.tools = tools;
        payload.tool_choice = "auto";
      } else {
        payload.tool_choice = "none";
      }

      const res = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload),
        mode: "cors"
      });

      if (!res.ok) {
        throw new Error("LM HTTP " + res.status + " " + res.statusText);
      }

      const data = await res.json();
      const choice = data.choices && data.choices[0];
      if (!choice) {
        throw new Error("Empty LM choice");
      }

      return choice;
    }

    async function callSearchEngine(query) {
      const url = `${SEARCH_FN_URL}?q=${encodeURIComponent(query)}`;
      const res = await fetch(url, { method: "GET" });
      if (!res.ok) {
        throw new Error("search-engine HTTP " + res.status);
      }
      return await res.json();
    }

    async function sendShadow(text) {
      if (sending) return;
      const prompt = (text || "").trim();
      if (!prompt) return;

      sending = true;
      sendBtn.disabled = true;

      appendUserLine(prompt);
      messages.push({ role: "user", content: prompt });

      const thinkingRow = appendThinkingLine();
      appendTrace(`[user] ${prompt}`);

      try {
        // 1) první volání – shadow může požádat o tool
        let choice = await callLM(messages, true);
        let msg = choice.message;
        let finishReason = choice.finish_reason;

        // pokud model vyžádal tool_calls
        if (msg.tool_calls && msg.tool_calls.length > 0) {
          const call = msg.tool_calls[0];
          if (call.function && call.function.name === "web_search") {
            let args = {};
            try {
              args = JSON.parse(call.function.arguments || "{}");
            } catch (e) {
              appendTrace("[tool] nešlo přečíst argumenty web_search", "err");
            }

            const q = args.query || prompt;
            appendTrace(`[tool] web_search("${q}")`, "warn");

            // označ, že se použil tool
            lastToolUse = q;

            // vytáhneme data z našeho search-engine
            let results;
            try {
              const data = await callSearchEngine(q);
              results = data;
              appendTrace("[tool] search-engine OK", "warn");
            } catch (e) {
              appendTrace("[tool] search-engine fail: " + e.message, "err");
              results = { error: e.message || String(e) };
            }

            // přidáme tool message do kontextu
            messages.push({
              role: "tool",
              name: "web_search",
              content: JSON.stringify(results)
            });

            // 2) druhé volání LM – tentokrát bez dalších toolů
            choice = await callLM(messages, false);
            msg = choice.message;
            finishReason = choice.finish_reason;
          }
        }

        const rawContent = msg.content || "";
        let clean = stripThinkBlocks(rawContent);

        if (!clean) {
          clean = "…řekněme, že tahle odpověď skončila v šumu. Zkus to znovu s jiným úhlem.";
        }

        thinkingRow.remove();
        const shadowTextEl = appendShadowLinePlaceholder();
        await typeWriter(shadowTextEl, clean, 12);

        messages.push({ role: "assistant", content: clean });
        appendTrace(`[shadow] reply (${clean.length} chars)`);

      } catch (err) {
        console.error(err);
        thinkingRow.remove();
        appendLine("SHADOW", "shadow", "❌ Chyba linky: " + (err.message || err), `[${nowTime()}]`);
        appendTrace("[err] " + (err.message || err), "err");
      } finally {
        sending = false;
        sendBtn.disabled = false;
        inputEl.focus();
      }
    }

    // ===== EVENT HANDLERS =====

    sendBtn.addEventListener("click", () => {
      sendShadow(inputEl.value);
      inputEl.value = "";
    });

    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendShadow(inputEl.value);
        inputEl.value = "";
      }
    });

    document.querySelectorAll(".chip").forEach(chip => {
      chip.addEventListener("click", () => {
        const prompt = chip.getAttribute("data-prompt") || chip.textContent.trim();
        inputEl.value = prompt;
        sendShadow(prompt);
        inputEl.value = "";
      });
    });

    // ===== INIT =====
    (function init() {
      appendSystemLine("Session inicializovaná. Napiš dotaz. Shadow je napojený na tvůj lokální LM + web_search.");
      statusLightEl.textContent = "ready · waiting for input";
      inputEl.focus();
    })();
  </script>
</body>
</html>
