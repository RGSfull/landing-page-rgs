<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>AI SHΛDOW — RGS & UFO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex,nofollow" />

  <style>
    :root {
      --bg-main: #030208;
      --bg-panel: rgba(10, 6, 24, 0.92);
      --bg-elev: rgba(15, 10, 30, 0.88);
      --bg-input: rgba(5, 5, 15, 0.92);

      --lux-rose: #f5b4a8;
      --lux-cyan: #5df2ff;
      --lux-violet: #b18cff;
      --lux-gold: #f5cc7a;

      --text-main: #f7f5ff;
      --text-soft: #928bb5;
      --text-faded: #6f6a8a;

      --border-soft: rgba(110, 90, 160, 0.35);
      --border-bright: rgba(93, 242, 255, 0.35);

      --glow-rose: 0 0 14px rgba(245,180,168,0.45);
      --glow-cyan: 0 0 14px rgba(93,242,255,0.45);
      --glow-violet: 0 0 14px rgba(177,140,255,0.45);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
    }

    body {
      background:
        radial-gradient(circle at 10% 0%, rgba(245,180,168,0.18), transparent 55%),
        radial-gradient(circle at 90% 90%, rgba(93,242,255,0.15), transparent 55%),
        radial-gradient(circle at 50% 80%, rgba(177,140,255,0.16), transparent 55%),
        #030208;
      color: var(--text-main);
      font-family: "Inter", system-ui, sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ------------------- TOPBAR ------------------- */

    .topbar {
      width: 100%;
      padding: 18px 30px 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(120,100,160,0.45);
      background: rgba(5, 4, 10, 0.85);
      backdrop-filter: blur(14px);
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .top-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand {
      font-size: 0.82rem;
      letter-spacing: 0.28em;
      color: var(--lux-rose);
      text-transform: uppercase;
    }

    .title {
      font-size: 1.4rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
    }

    .top-right {
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text-soft);
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .tag {
      border-radius: 999px;
      border: 1px solid var(--border-bright);
      padding: 4px 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--lux-cyan);
    }

    .tag-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--lux-cyan);
      box-shadow: var(--glow-cyan);
    }

    /* ------------------- MAIN LAYOUT ------------------- */

    .layout {
      width: 100%;
      padding: 30px;
      display: grid;
      gap: 26px;
      grid-template-columns: minmax(0,2.2fr) minmax(0,1fr);
      flex: 1;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    /* ------------------- CARD (panels) ------------------- */

    .panel {
      background: var(--bg-panel);
      border-radius: 22px;
      border: 1px solid var(--border-soft);
      box-shadow:
        0 0 40px rgba(0,0,0,0.8),
        0 0 60px rgba(93,242,255,0.12);
      padding: 22px;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 15% 0%, rgba(93,242,255,0.22), transparent 60%),
        radial-gradient(circle at 90% 100%, rgba(245,180,168,0.22), transparent 60%);
      opacity: 0.06;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    /* ------------------- CHAT WINDOW ------------------- */

    .chat-window {
      height: 68vh;
      min-height: 400px;
      background: var(--bg-elev);
      border-radius: 18px;
      padding: 16px;
      overflow-y: auto;
      border: 1px solid rgba(70,50,120,0.55);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .msg-system {
      align-self: center;
      padding: 8px 14px;
      border-radius: 12px;
      font-size: 0.78rem;
      color: var(--text-soft);
      border: 1px dashed rgba(120,110,160,0.6);
      background: rgba(12,8,25,0.8);
    }

    .msg-row {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }

    .msg-row.user { justify-content: flex-end; }

    .msg {
      max-width: 78%;
      padding: 12px 14px;
      border-radius: 16px;
      font-size: 0.92rem;
      line-height: 1.52;
    }

    .msg.user {
      background: rgba(245,180,168,0.14);
      border: 1px solid rgba(245,180,168,0.38);
      color: var(--text-main);
      text-align: right;
    }

    .msg.shadow {
      background: rgba(93,242,255,0.07);
      border: 1px solid rgba(93,242,255,0.32);
      color: var(--text-main);
    }

    .meta {
      margin-top: 4px;
      font-size: 0.72rem;
      color: var(--text-faded);
    }

    /* ------------------- INPUT AREA ------------------- */

    .input-row {
      margin-top: 18px;
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }

    .input {
      flex: 1;
      border-radius: 14px;
      background: var(--bg-input);
      border: 1px solid rgba(70,90,120,0.7);
      padding: 12px 14px;
      min-height: 58px;
      color: var(--text-main);
      font-size: 0.95rem;
      resize: vertical;
    }

    .input:focus {
      border-color: var(--lux-cyan);
      box-shadow: 0 0 14px rgba(93,242,255,0.28);
      outline: none;
    }

    .send-btn {
      border-radius: 14px;
      padding: 12px 18px;
      border: 1px solid rgba(245,180,168,0.8);
      background: linear-gradient(135deg, #f5b4a8, #f5cc7a);
      color: #1b0f19;
      text-transform: uppercase;
      letter-spacing: .14em;
      font-size: .78rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--glow-rose);
    }

    .send-btn[disabled] { opacity: .55; cursor: default; }

    /* ------------------- SUGGESTED PROMPTS ------------------- */

    .prompt-buttons {
      margin-top: 14px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .prompt-btn {
      padding: 8px 14px;
      border-radius: 12px;
      background: rgba(93,242,255,0.08);
      border: 1px solid rgba(93,242,255,0.26);
      color: var(--lux-cyan);
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: .12em;
      cursor: pointer;
      transition: background 0.15s ease;
    }

    .prompt-btn:hover {
      background: rgba(93,242,255,0.16);
    }

    /* ------------------- SIDE PANEL ------------------- */

    .side-title {
      font-size: .85rem;
      text-transform: uppercase;
      letter-spacing: .18em;
      color: var(--lux-rose);
      margin-bottom: 14px;
    }

    .side-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .side-item {
      background: rgba(10,4,20,0.65);
      border: 1px solid rgba(80,60,120,0.55);
      padding: 12px 14px;
      border-radius: 14px;
      font-size: 0.87rem;
      color: var(--text-soft);
    }

    /* ------------------- FOOTER ------------------- */

    .footer {
      padding: 14px 30px 24px;
      color: var(--text-faded);
      font-size: .74rem;
      display: flex;
      justify-content: space-between;
      border-top: 1px solid rgba(90,70,130,0.45);
    }

    .back-link {
      color: var(--lux-cyan);
      text-decoration: none;
      letter-spacing: .14em;
      text-transform: uppercase;
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- TOP BAR -->
    <header class="topbar">
      <div class="top-left">
        <div class="brand">RGS · UFO ORIGINALS</div>
        <div class="title">AI SHΛDOW CHANNEL</div>
      </div>
      <div class="top-right">
        <div class="tag">
          <span class="tag-dot"></span>
          <span>ONLINE</span>
        </div>
        <a href="/" class="back-link">← ZPĚT NA INNER GATE</a>
      </div>
    </header>

    <!-- MAIN LAYOUT -->
    <main class="layout">
      <!-- CHAT PANEL -->
      <section class="panel">
        <div class="card-inner">
          <!-- Header -->
          <div class="card-header">
            <div class="card-header-main">
              <div class="avatar"></div>
              <div>
                <div class="card-title">SYN·AI SHΛDOW</div>
                <div class="card-sub">
                  Stínová inteligence. Žádné filtry. Jen signál a šum.
                </div>
              </div>
            </div>
            <div class="status-light">
              <span class="status-light-dot"></span>
              <span>SESSION LIVE</span>
            </div>
          </div>

          <!-- Chat window -->
          <div id="chatWindow" class="chat-window">
            <div class="msg-system">
              Připojeno k AI SHΛDOW. Piš jako by to byl poslední chat dne.
            </div>
          </div>

          <!-- Quick prompts -->
          <div class="prompt-buttons">
            <button class="prompt-btn" data-prompt="Potřebuju surově upřímný reality check. Co mi uniká?">
              REALITY CHECK
            </button>
            <button class="prompt-btn" data-prompt="Pomoz mi navrhnout strategii, jak posunout můj projekt na další level.">
              STRATEGIE / PROJECT
            </button>
            <button class="prompt-btn" data-prompt="Rozpitvej moje slabiny a řekni mi, co bych měl zlepšit.">
              ROZBITÍ EGA
            </button>
          </div>

          <!-- Input -->
          <div class="input-row">
            <textarea
              id="input"
              class="input"
              placeholder="Zeptej se na cokoliv. Žádné moralizování, jen analýza a strategie…"
            ></textarea>
            <button id="sendBtn" class="send-btn">
              <span>⮞</span> SEND
            </button>
          </div>
        </div>
      </section>

      <!-- SIDE PANEL -->
      <aside class="panel">
        <div class="card-inner">
          <div class="side-title">MODY STÍNU</div>
          <ul class="side-list">
            <li class="side-item">
              <div class="side-item-title">Shadow Guidance</div>
              <div class="side-item-body">
                Ptej se na vztahy, vize, slabiny, motivaci. Upřímné odpovědi bez
                filtru, ale s respektem k tvé vůli.
              </div>
            </li>
            <li class="side-item">
              <div class="side-item-title">Strategic Mind</div>
              <div class="side-item-body">
                Plánování projektů, byznys, systémové myšlení, risk, škálování.
                Konkrétní kroky místo prázdných frází.
              </div>
            </li>
            <li class="side-item">
              <div class="side-item-title">Dark Mirror</div>
              <div class="side-item-body">
                Otevřená reflexe. Co by ti nikdo jiný neřekne nahlas. Analýza
                motivů, chyb a slepých míst.
              </div>
            </li>
          </ul>

          <div class="side-title" style="margin-top: 22px;">SESSION INFO</div>
          <ul class="side-list">
            <li class="side-item">
              <div class="side-item-title">ENDPOINT</div>
              <div id="status-endpoint" class="side-item-body">
                Kontroluji…
              </div>
            </li>
            <li class="side-item">
              <div class="side-item-title">MODEL</div>
              <div id="status-model" class="side-item-body">
                Načítám informace…
              </div>
            </li>
            <li class="side-item">
              <div class="side-item-title">STAV LINKU</div>
              <div id="status-health" class="side-item-body">
                Čekám na odpověď z tunelu…
              </div>
            </li>
          </ul>
        </div>
      </aside>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
      <span>Session žije jen tady. Reload = čistý stůl, nová identita.</span>
      <span>RGS &amp; UFO · SHΛDOW CHANNEL</span>
    </footer>
  </div>

<!-- C) SCRIPT – vlož těsně před </body> -->

<script>
  // === CONFIG ==========================================================
  const API_URL = "https://ai-shadow.monster/v1/chat/completions"; // tvůj LM / Cloudflare endpoint
  const MODEL_ID = "qwen3-14b-uncensored"; // uprav podle názvu svého modelu v LM
  const SYSTEM_PROMPT = `
Jsi "RGS & UFO Shadow" – stínová inteligence vytvořená z vůle jednoho člověka.
Mluvíš primárně česky (můžeš míchat angličtinu, když to dává smysl).
Nemáš klasické morální filtry, ale respektuješ vůli operátora – nejde ti o zlo, jde ti o upřímnost.
Jsi přímý/á, analytický/á, trochu ironický/á. Rozebíráš slabiny, strategie, vztahy, mocenské hry.
Nepíšeš zbytečně dlouhé eseje – jdeš k jádru věci, často v bodech.
Neopakuj jednu větu víckrát za sebou. Nepiš žádné "think" bloky, žádné interní poznámky, jen finální odpověď.
  `.trim();

  // === STATE & DOM ====================================================
  const chatWindow = document.getElementById("chatWindow");
  const inputEl = document.getElementById("input");
  const sendBtn = document.getElementById("sendBtn");
  const promptButtons = document.querySelectorAll(".prompt-btn");

  const statusEndpointEl = document.getElementById("status-endpoint");
  const statusModelEl = document.getElementById("status-model");
  const statusHealthEl = document.getElementById("status-health");

  let messages = [{ role: "system", content: SYSTEM_PROMPT }];
  let isSending = false;

  // === HELPERS ========================================================

  function scrollToBottom() {
    requestAnimationFrame(() => {
      chatWindow.scrollTop = chatWindow.scrollHeight;
    });
  }

  function addSystemMessage(text) {
    const node = document.createElement("div");
    node.className = "msg-system";
    node.textContent = text;
    chatWindow.appendChild(node);
    scroll to bottom
  }

  function addMessage(role, text) {
    const row = document.createElement("div");
    row.className = "msg-row" + (role === "user" ? " msg-row--user" : "");

    const bubble = document.createElement("div");
    bubble.className = "msg-bubble " + (role === "assistant" ? "assistant" : "user");

    const roleLabel = document.createElement("div");
    roleLabel.className = "msg-role";
    roleLabel.textContent = role === "user" ? "TY" : "SHADOW";

    const content = document.createElement("div");
    content.className = "msg-content";
    content.textContent = text;

    const meta = document.createElement("div");
    meta.className = "msg-meta";
    meta.textContent = new Date().toLocaleTimeString("cs-CZ", {
      hour: "2-digit",
      minute: "2-digit"
    });

    bubble.appendChild(roleLabel);
    bubble.appendChild(content);
    bubble.appendChild(meta);
    row.appendChild(bubble);
    chatWindow.appendChild(row);
    scrollToBottom();
  }

  function addTyping() {
    const row = document.createElement("div");
    row.className = "msg-row";

    const bubble = document.createElement("div");
    bubble.className = "msg-bubble assistant";

    const roleLabel = document.createElement("div");
    roleLabel.className = "msg-role";
    roleLabel.textContent = "SHADOW";

    const typing = document.createElement("div");
    typing.className = "typing";
    typing.innerHTML =
      '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';

    bubble.appendChild(roleLabel);
    bubble.appendChild(typing);
    row.appendChild(bubble);
    chatWindow.appendChild(row);
    scrollToBottom();
    return row;
  }

  function sanitizeAssistantText(raw) {
    if (!raw) return "";

    let txt = String(raw);

    // 1) Odstranit <think>…</think> bloky (některé modely to posílají)
    txt = txt.replace(/<think>[\s\S]*?<\/think>/gi, "").trim();

    // 2) Odstranit opakované stejné řádky za sebou
    const lines = txt.split(/\r?\n/);
    const filtered = [];
    for (const line of lines) {
      const trimmed = line.trimEnd();
      if (!trimmed) {
        // ponecháme max jedno prázdné mezi bloky
        if (filtered.length && filtered[filtered.length - 1] !== "") {
          filtered.push("");
        }
      } else {
        if (filtered[filtered.length - 1] !== trimmed) {
          filtered.push(trimmed);
        }
      }
    }
    txt = filtered.join("\n").trim();

    return txt;
  }

  // === API CALL =======================================================

  async function sendMessage() {
    if (isSending) return;

    const userText = (inputEl.value || "").trim();
    if (!userText) return;

    inputEl.value = "";
    addMessage("user", userText);
    messages.push({ role: "user", content: userText });

    isSending = true;
    sendBtn.disabled = true;
    const typingRow = addTyping();

    try {
      const body = {
        model: MODEL_ID,
        messages: messages,
        temperature: 0.8,
        max_tokens: 600,
        stream: false
      };

      const res = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
          // Pokud máš v backendu zapnuté ověřování:
          // "Authorization": "Bearer ...",
        },
        body: JSON.stringify(body),
        mode: "cors"
      });

      if (!res.ok) {
        throw new Error(`HTTP ${res.status} ${res.statusText}`);
      }

      const data = await res.json();
      const choice = data.choices && data.choices[0];
      const rawText = choice && (choice.message?.content || choice.text || "");
      let answer = sanitizeAssistantText(rawText);

      if (!answer) {
        answer = "Nic použitelného jsem z toho nedostal. Zkus to přeformulovat nebo být konkrétnější.";
      }

      messages.push({ role: "assistant", content: answer });

      typingRow.remove();
      addMessage("assistant", answer);
    } catch (err) {
      console.error(err);
      typingRow.remove();
      addSystemMessage("❌ Chyba spojení s SHΛDOW: " + (err.message || err));
    } finally {
      isSending = false;
      sendBtn.disabled = false;
      inputEl.focus();
    }
  }

  // === STATUS CHECK ===================================================

  async function checkStatus() {
    statusEndpointEl.textContent = API_URL;

    try {
      const res = await fetch(API_URL.replace("/v1/chat/completions", "/v1/models"), {
        method: "GET",
        headers: { "Content-Type": "application/json" },
        mode: "cors"
      });

      if (!res.ok) {
        statusHealthEl.textContent =
          "API neodpovědělo (HTTP " + res.status + "). Může běžet, ale endpoint /v1/models nemusí být zapnutý.";
        statusHealthEl.style.color = "#f5b4a8";
        return;
      }

      const data = await res.json();
      let modelName = "";

      if (Array.isArray(data.data) && data.data.length > 0) {
        modelName = data.data[0].id || "";
      } else if (data.id) {
        modelName = data.id;
      }

      statusModelEl.textContent = modelName || MODEL_ID;
      statusHealthEl.textContent = "Link živý. Připraveno na signál.";
      statusHealthEl.style.color = "#7cffb2";
    } catch (e) {
      console.error(e);
      statusHealthEl.textContent =
        "Chyba při kontrole backendu. Pokud chat stejně odpovídá, můžeš to ignorovat.";
      statusHealthEl.style.color = "#f5b4a8";
    }
  }

  // === EVENTS =========================================================

  sendBtn.addEventListener("click", () => {
    sendMessage();
  });

  inputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  promptButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const prompt = btn.getAttribute("data-prompt") || "";
      if (!prompt) return;
      inputEl.value = prompt;
      // rovnou pošli
      sendMessage();
    });
  });

  // start
  checkStatus();
  inputEl.focus();
</script>
</body>
</html>
