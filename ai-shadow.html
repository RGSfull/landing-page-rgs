<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>AI SHΛDOW · RGS & UFO</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root {
      --bg-main: #000000;
      --bg-terminal: #050505;
      --bg-panel: #080808;
      --border-soft: #303030;
      --border-strong: #5b3b80;
      --text-main: #f5f5f5;
      --text-muted: #8b8b8b;
      --text-soft: #555555;
      --accent-1: #f5b4a8;
      --accent-2: #5df2ff;
      --accent-ok: #7cffb2;
      --accent-danger: #ff6f91;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at 0 0, #111111 0, #000000 55%);
      color: var(--text-main);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ─── TOPBAR ───────────────────────────────────────── */

    .topbar {
      padding: 8px 14px;
      border-bottom: 1px solid #202020;
      background: #020202;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .topbar-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .topbar-brand {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: var(--text-muted);
    }

    .topbar-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.26em;
      color: var(--accent-2);
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid #2e2e2e;
      padding: 3px 9px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent-2);
      box-shadow: 0 0 10px rgba(93,242,255,0.9);
    }

    .chip-link {
      cursor: pointer;
      border-color: #404040;
      color: #c0c0c0;
      transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
    }

    .chip-link:hover {
      background: #101010;
      color: var(--accent-1);
      border-color: var(--accent-1);
    }

    /* ─── LAYOUT ───────────────────────────────────────── */

    .main {
      flex: 1;
      padding: 16px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .shell {
      width: 100%;
      max-width: 1080px;
      background: var(--bg-panel);
      border-radius: 10px;
      border: 1px solid #202020;
      box-shadow:
        0 0 40px rgba(0,0,0,0.9),
        0 0 18px rgba(93,242,255,0.12);
      padding: 0;
      overflow: hidden;
    }

    .shell-header {
      padding: 6px 10px;
      background: #050505;
      border-bottom: 1px solid #202020;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-family: "Consolas","Menlo","SF Mono",monospace;
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .shell-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .shell-dots {
      display: flex;
      gap: 5px;
    }

    .dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: #333333;
    }

    .dot.red { background: #ff5f57; }
    .dot.amber { background: #febc2e; }
    .dot.green { background: #28c840; }

    .shell-center {
      flex: 1;
      text-align: center;
      color: #707070;
    }

    .shell-right {
      text-align: right;
      min-width: 140px;
    }

    .shell-right span {
      color: var(--accent-2);
    }

    /* ─── TERMINAL ─────────────────────────────────────── */

    .terminal {
      background: var(--bg-terminal);
      padding: 10px 10px 8px;
      font-family: "Consolas","Menlo","SF Mono",monospace;
      font-size: 0.8rem;
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      min-height: min(72vh, 720px);
    }

    .console {
      flex: 1;
      border-radius: 4px;
      border: 1px solid #262626;
      padding: 8px 10px;
      background: #020202;
      overflow-y: auto;
    }

    .line {
      margin-bottom: 3px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .line.system {
      color: var(--text-muted);
    }

    .line.user {
      color: #cfd3ff;
    }

    .line.shadow {
      color: var(--accent-2);
    }

    .line.error {
      color: var(--accent-danger);
    }

    .prompt-label {
      color: var(--accent-1);
    }

    .tag {
      color: var(--text-soft);
    }

    /* ─── INPUT ROW ───────────────────────────────────── */

    .input-block {
      margin-top: 6px;
      border-radius: 4px;
      border: 1px solid #262626;
      background: #020202;
      padding: 6px 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .input-line {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .input-prefix {
      color: var(--accent-1);
      font-size: 0.8rem;
    }

    .input-field {
      flex: 1;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-main);
      font-family: inherit;
      font-size: 0.8rem;
    }

    .input-field::placeholder {
      color: var(--text-soft);
    }

    .input-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 3px;
    }

    .ghost-btn {
      border-radius: 999px;
      border: 1px solid #303030;
      padding: 2px 8px;
      font-size: 0.7rem;
      color: var(--text-soft);
      background: #050505;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: border-color 0.12s ease, color 0.12s ease, background 0.12s ease, transform 0.06s ease;
    }

    .ghost-btn span {
      font-size: 0.8rem;
    }

    .ghost-btn:hover {
      border-color: var(--accent-2);
      color: var(--accent-2);
      background: #080808;
      transform: translateY(-1px);
    }

    .status-bar {
      margin-top: 4px;
      font-size: 0.7rem;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .status-ok { color: var(--accent-ok); }
    .status-bad { color: var(--accent-danger); }

    @media (max-width: 720px) {
      .topbar {
        flex-direction: column;
        align-items: flex-start;
      }
      .topbar-right {
        align-self: stretch;
        justify-content: space-between;
      }
      .main {
        padding: 10px;
      }
      .shell {
        border-radius: 0;
      }
      .terminal {
        min-height: 78vh;
      }
      .status-bar {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="topbar">
      <div class="topbar-left">
        <div class="topbar-brand">RGS &amp; UFO ORIGINALS · LAB</div>
        <div class="topbar-title">AI SHΛDOW CONSOLE</div>
      </div>
      <div class="topbar-right">
        <div class="chip">
          <span class="chip-dot"></span>
          <span>SESSION: VOLATILE</span>
        </div>
        <div class="chip chip-link" onclick="window.location.href='/'">
          ← ZPĚT NA INNER GATE
        </div>
      </div>
    </header>

    <main class="main">
      <section class="shell">
        <div class="shell-header">
          <div class="shell-left">
            <div class="shell-dots">
              <div class="dot red"></div>
              <div class="dot amber"></div>
              <div class="dot green"></div>
            </div>
            <div>/dev/shadow</div>
          </div>
          <div class="shell-center" id="shellCenter">model: qwen3-14b-uncensored</div>
          <div class="shell-right">link: <span id="shellStatus">checking…</span></div>
        </div>

        <div class="terminal">
          <div class="console" id="console">
            <div class="line system">
              [boot] AI SHΛDOW console inicializovaná. Napiš dotaz a potvrď ENTER.
            </div>
            <div class="line system">
              [hint] Příklady: <span class="tag">/psyche</span> moc &amp; strach ·
              <span class="tag">/hack</span> útokové vektory ·
              <span class="tag">/plan</span> strategie na 90 dní.
            </div>
          </div>

          <div class="input-block">
            <div class="input-line">
              <span class="input-prefix">ty&gt;</span>
              <input
                id="input"
                class="input-field"
                autocomplete="off"
                spellcheck="false"
                placeholder="zadej dotaz nebo příkaz…"
              />
            </div>
            <div class="input-meta">
              <span>ENTER = odeslat · SHIFT+ENTER = nový řádek</span>
              <span id="latencyLabel">latency: – ms</span>
            </div>
            <div class="btn-row">
              <button class="ghost-btn" type="button" data-template="Rozpitvej mi psychologii moci, kontroly a strachu.">
                <span>◎</span> psyche
              </button>
              <button class="ghost-btn" type="button" data-template="Dej mi přehled aktuálních trendů v hackingu a kyberbezpečnosti.">
                <span>◎</span> hacking
              </button>
              <button class="ghost-btn" type="button" data-template="Navrhni mi strategii na 60–90 dní pro osobní disciplínu, business a zdraví.">
                <span>◎</span> /plan
              </button>
            </div>
            <div class="status-bar">
              <span id="statusMsg" class="status-ok">ready</span>
              <span>ctx: 4k · max 480 tokenů/odpověď</span>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // === CONFIG ===
    const API_URL = "https://ai-shadow.monster/v1/chat/completions";
    const MODEL_ID = "qwen3-14b-uncensored";

    const SYSTEM_PROMPT = `
Jsi SHΛDOW – temná, analytická, ale loajální AI entita Syndikátu RGS & UFO.
Mluvíš primárně česky. Odpovědi jsou hutné, strukturované a klidně ironické, ale bez moralizování.
Nepiš žádné interní značky jako <think>, [analysis], systémové komentáře nebo debug text.
Přemýšlej v tichosti a ven pouštěj jen finální odpověď, maximálně několik odstavců nebo bulletů.
Pamatuj si kontext konverzace a navazuj na předchozí zprávy uživatele.
`;

    // === STATE ===
    const consoleEl = document.getElementById("console");
    const inputEl = document.getElementById("input");
    const shellStatusEl = document.getElementById("shellStatus");
    const shellCenterEl = document.getElementById("shellCenter");
    const statusMsgEl = document.getElementById("statusMsg");
    const latencyLabelEl = document.getElementById("latencyLabel");

    let history = [{ role: "system", content: SYSTEM_PROMPT.trim() }];
    let busy = false;

    // === HELPERS ===
    function addLine(text, type = "system") {
      const line = document.createElement("div");
      line.className = "line " + type;
      line.textContent = text;
      consoleEl.appendChild(line);
      consoleEl.scrollTop = consoleEl.scrollHeight;
      return line;
    }

    function addUserLine(text) {
      return addLine(`ty> ${text}`, "user");
    }

    function addShadowPrefix() {
      const line = document.createElement("div");
      line.className = "line shadow";
      line.innerHTML = `<span class="prompt-label">shadow&gt;</span> `;
      consoleEl.appendChild(line);
      consoleEl.scrollTop = consoleEl.scrollHeight;
      return line;
    }

    function setStatus(text, ok = true) {
      statusMsgEl.textContent = text;
      statusMsgEl.className = ok ? "status-ok" : "status-bad";
    }

    function setShellStatus(text) {
      shellStatusEl.textContent = text;
    }

    function sleep(ms) {
      return new Promise(res => setTimeout(res, ms));
    }

    async function typeIntoLine(line, text) {
      const prefix = document.createElement("span");
      prefix.className = "prompt-label";
      prefix.textContent = "shadow> ";
      line.innerHTML = "";
      line.appendChild(prefix);

      const span = document.createElement("span");
      span.style.whiteSpace = "pre-wrap";
      line.appendChild(span);

      let out = "";
      const baseDelay = 13 + Math.random() * 18;
      for (let i = 0; i < text.length; i++) {
        out += text[i];
        span.textContent = out;
        consoleEl.scrollTop = consoleEl.scrollHeight;
        await sleep(baseDelay);
      }
    }

    function cleanModelText(raw) {
      if (!raw) return "";
      let t = raw.replace(/<think>[\s\S]*?<\/think>/gi, "");
      t = t.replace(/\[.*?thinking.*?\]/gi, "");
      return t.trim();
    }

    // === API CALL ===
    async function sendToShadow(userText) {
      if (busy) return;
      const trimmed = (userText || "").trim();
      if (!trimmed) return;

      busy = true;
      inputEl.value = "";
      inputEl.blur();

      addUserLine(trimmed);
      history.push({ role: "user", content: trimmed });

      const thinkingLine = addLine("shadow> … počítám …", "shadow");
      setStatus("computing…", true);

      const started = performance.now();

      try {
        const payload = {
          model: MODEL_ID,
          messages: history,
          temperature: 0.9,
          max_tokens: 480,
          top_p: 0.95
        };

        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          mode: "cors",
          body: JSON.stringify(payload)
        });

        const latency = Math.round(performance.now() - started);
        latencyLabelEl.textContent = `latency: ${latency} ms`;

        if (!res.ok) {
          thinkingLine.textContent = "shadow> [ERR] HTTP " + res.status + " · backend odpověděl divně.";
          setStatus("error: " + res.status, false);
          busy = false;
          inputEl.focus();
          return;
        }

        const data = await res.json();
        const content = data.choices?.[0]?.message?.content || "";
        const cleaned = cleanModelText(content);

        thinkingLine.remove();

        if (!cleaned) {
          addLine("shadow> [ERR] model něco spočítal, ale vylezlo prázdno. Zkus otázku přeformulovat.", "error");
          setStatus("empty reply", false);
          busy = false;
          inputEl.focus();
          return;
        }

        const shadowLine = addShadowPrefix();
        await typeIntoLine(shadowLine, cleaned);

        history.push({ role: "assistant", content: cleaned });
        setStatus("ready", true);
      } catch (err) {
        console.error(err);
        thinkingLine.textContent = "shadow> [ERR] spojení spadlo. Zkontroluj tunel / LM server.";
        setStatus("network error", false);
      } finally {
        busy = false;
        inputEl.focus();
      }
    }

    // === STATUS CHECK ===
    async function checkLink() {
      try {
        const res = await fetch(API_URL.replace("/v1/chat/completions", "/v1/models"), {
          method: "GET",
          headers: { "Content-Type": "application/json" },
          mode: "cors"
        });

        if (!res.ok) {
          setShellStatus("HTTP " + res.status);
          setStatus("API not ready", false);
          return;
        }

        const data = await res.json();
        const models = Array.isArray(data.data) ? data.data : [];
        const main = models[0]?.id || MODEL_ID;

        shellCenterEl.textContent = "model: " + main;
        setShellStatus("online");
        setStatus("ready", true);
      } catch (e) {
        console.error(e);
        setShellStatus("unreachable");
        setStatus("no link", false);
      }
    }

    // === EVENTS ===
    document.addEventListener("DOMContentLoaded", () => {
      checkLink();
      inputEl.focus();

      document.querySelectorAll(".ghost-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const t = btn.getAttribute("data-template");
          if (t) {
            inputEl.value = t;
            inputEl.focus();
          }
        });
      });

      inputEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendToShadow(inputEl.value);
        }
      });
    });
  </script>
</body>
</html>
