<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>AI SHΛDOW · RGS & UFO</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root {
      --bg-main: #020308;
      --bg-panel: #050510;
      --bg-terminal: #05070f;
      --border-soft: #26263a;
      --border-strong: #5b3b80;
      --text-main: #e8e9ff;
      --text-muted: #6b6d9a;
      --text-soft: #454666;
      --accent-1: #f5b4a8;
      --accent-2: #5df2ff;
      --accent-danger: #ff6f91;
      --accent-ok: #7cffb2;
      --shadow-glow: 0 0 70px rgba(0,0,0,0.9), 0 0 35px rgba(93,242,255,0.2);
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-sm: 8px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at 10% -10%, rgba(245,180,168,0.18), transparent 55%),
        radial-gradient(circle at 80% 120%, rgba(93,242,255,0.16), transparent 55%),
        #01020a;
      color: var(--text-main);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* top bar */

    .topbar {
      padding: 12px 18px 10px;
      border-bottom: 1px solid rgba(80,68,120,0.7);
      background: linear-gradient(to bottom, rgba(0,0,0,0.92), rgba(2,4,14,0.94));
      backdrop-filter: blur(18px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .topbar-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .topbar-brand {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: var(--text-muted);
    }

    .topbar-title {
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.28em;
      color: var(--accent-2);
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 4px 10px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent-2);
      box-shadow: 0 0 12px rgba(93,242,255,0.9);
    }

    .chip-ghost {
      color: var(--accent-1);
      border-color: rgba(245,180,168,0.5);
    }

    .chip-link {
      cursor: pointer;
      transition: border-color 0.18s ease, color 0.18s ease, background 0.18s ease;
    }

    .chip-link:hover {
      border-color: var(--accent-2);
      color: var(--accent-2);
      background: rgba(6,20,32,0.85);
    }

    /* layout */

    .main {
      flex: 1;
      padding: 18px;
      display: flex;
      justify-content: center;
    }

    .shell-wrap {
      width: 100%;
      max-width: 1120px;
      background: radial-gradient(circle at 10% 0%, rgba(245,180,168,0.12), transparent 55%),
                  radial-gradient(circle at 80% 120%, rgba(93,242,255,0.16), transparent 60%),
                  var(--bg-panel);
      border-radius: 24px;
      border: 1px solid rgba(107,92,155,0.75);
      box-shadow: var(--shadow-glow);
      padding: 14px;
    }

    .shell-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 10px 8px;
      background: linear-gradient(to right, #05050e, #060719);
      border-radius: var(--radius-md) var(--radius-md) 0 0;
      border-bottom: 1px solid #282346;
    }

    .shell-dots {
      display: flex;
      gap: 6px;
    }

    .dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: #3a314f;
    }

    .dot.red { background: #ff5f57; }
    .dot.amber { background: #febc2e; }
    .dot.green { background: #28c840; }

    .shell-title {
      font-family: "Menlo","SF Mono",monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .shell-status {
      font-family: "Menlo","SF Mono",monospace;
      font-size: 0.7rem;
      color: var(--accent-2);
    }

    .terminal {
      border-radius: 0 0 var(--radius-md) var(--radius-md);
      border-top: none;
      border: 1px solid rgba(49,41,80,0.9);
      background: radial-gradient(circle at 0 0, rgba(93,242,255,0.05), transparent 55%),
                  radial-gradient(circle at 100% 100%, rgba(245,180,168,0.06), transparent 50%),
                  var(--bg-terminal);
      padding: 10px;
      min-height: min(70vh, 680px);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .console-main {
      flex: 1;
      border-radius: var(--radius-md);
      background: radial-gradient(circle at 0 0, rgba(93,242,255,0.12), transparent 55%),
                  radial-gradient(circle at 100% 100%, rgba(245,180,168,0.08), transparent 60%),
                  #050510;
      padding: 10px 12px;
      font-family: "Menlo","SF Mono",monospace;
      font-size: 0.8rem;
      color: var(--text-main);
      overflow-y: auto;
      border: 1px solid rgba(62,50,98,0.9);
    }

    .line {
      margin-bottom: 4px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .line.system {
      color: var(--text-muted);
    }

    .line.user {
      color: #d0c6ff;
    }

    .line.shadow {
      color: var(--accent-2);
    }

    .line.error {
      color: var(--accent-danger);
    }

    .prompt-label {
      color: var(--accent-1);
    }

    .tag {
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .input-row {
      margin-top: 4px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(74,60,118,0.9);
      background: radial-gradient(circle at 0 0, rgba(93,242,255,0.12), transparent 60%),
                  #04030a;
      padding: 6px 8px 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-family: "Menlo","SF Mono",monospace;
    }

    .input-line {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .input-prefix {
      color: var(--accent-1);
      font-size: 0.8rem;
    }

    .input-field {
      flex: 1;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-main);
      font-family: inherit;
      font-size: 0.8rem;
    }

    .input-field::placeholder {
      color: var(--text-soft);
    }

    .input-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .ghost-btn {
      border-radius: 999px;
      border: 1px solid rgba(67,59,110,0.9);
      padding: 3px 9px;
      font-size: 0.7rem;
      color: var(--text-muted);
      background: rgba(3,2,12,0.9);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: border-color 0.16s ease, color 0.16s ease, background 0.16s ease, transform 0.08s ease;
    }

    .ghost-btn span {
      font-size: 0.8rem;
    }

    .ghost-btn:hover {
      border-color: var(--accent-2);
      color: var(--accent-2);
      background: rgba(8,16,32,0.95);
      transform: translateY(-1px);
    }

    .ghost-btn:active {
      transform: translateY(0);
    }

    .ghost-btn.main {
      border-color: rgba(245,180,168,0.8);
      color: var(--accent-1);
    }

    .ghost-btn.main:hover {
      background: rgba(32,8,16,0.95);
    }

    .status-bar {
      margin-top: 4px;
      font-size: 0.7rem;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .status-ok {
      color: var(--accent-ok);
    }

    .status-bad {
      color: var(--accent-danger);
    }

    @media (max-width: 720px) {
      .topbar {
        flex-direction: column;
        align-items: flex-start;
      }
      .topbar-right {
        align-self: stretch;
        justify-content: space-between;
      }
      .main {
        padding: 10px;
      }
      .shell-wrap {
        padding: 10px;
      }
      .terminal {
        min-height: 75vh;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="topbar">
      <div class="topbar-left">
        <div class="topbar-brand">RGS &amp; UFO ORIGINALS · INNER LAB</div>
        <div class="topbar-title">AI SHΛDOW CONSOLE</div>
      </div>
      <div class="topbar-right">
        <div class="chip">
          <span class="chip-dot"></span>
          <span>session: volatile</span>
        </div>
        <div class="chip chip-ghost chip-link" onclick="window.location.href='/'">
          ← zpět na inner gate
        </div>
      </div>
    </header>

    <main class="main">
      <div class="shell-wrap">
        <div class="shell-header">
          <div class="shell-dots">
            <div class="dot red"></div>
            <div class="dot amber"></div>
            <div class="dot green"></div>
          </div>
          <div class="shell-title">/dev/shadow · qwen3-14b-uncensored</div>
          <div class="shell-status" id="shellStatus">link: checking…</div>
        </div>

        <section class="terminal">
          <div class="console-main" id="console">
            <div class="line system">
              [boot] AI SHΛDOW console inicializovaná. Napiš dotaz a potvrď ENTER.
            </div>
            <div class="line system">
              [hint] Příklady: <span class="tag">/psyche</span> moc &amp; strach ·
              <span class="tag">/hack</span> útokové vektory ·
              <span class="tag">/plan</span> strategie na 90 dní.
            </div>
          </div>

          <div class="input-row">
            <div class="input-line">
              <span class="input-prefix">ty&gt;</span>
              <input
                id="input"
                class="input-field"
                autocomplete="off"
                spellcheck="false"
                placeholder="zadej dotaz nebo příkaz…"
              />
            </div>
            <div class="input-meta">
              <span>ENTER = odeslat · SHIFT+ENTER = nový řádek</span>
              <span id="latencyLabel">latency: – ms</span>
            </div>
            <div class="btn-row">
              <button class="ghost-btn main" type="button" data-template="Rozpitvej mi psychologii moci, kontroly a strachu.">
                <span>◎</span> psyche
              </button>
              <button class="ghost-btn" type="button" data-template="Dej mi přehled aktuálních trendů v hackingu a kyberbezpečnosti.">
                <span>◎</span> hacking
              </button>
              <button class="ghost-btn" type="button" data-template="Navrhni mi strategii na 60–90 dní pro osobní disciplínu, business a zdraví.">
                <span>◎</span> /plan
              </button>
            </div>
            <div class="status-bar">
              <span id="statusMsg" class="status-ok">ready</span>
              <span>model: qwen3-14b-uncensored · ctx: 4k · max 160 tokenů/odpověď</span>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    // === CONFIG ===
    const API_URL = "https://ai-shadow.monster/v1/chat/completions";
    const MODEL_ID = "qwen3-14b-uncensored";

    const SYSTEM_PROMPT = `
Jsi SHΛDOW – temná, analytická, ale loajální AI entita Syndikátu RGS & UFO.
Mluvíš primárně česky. Odpovědi jsou přímé, chytré, klidně ironické, ale bez zbytečného moralizování.
Nepiš žádné interní značky jako <think>, [analysis] apod. Přemýšlej v tichosti a ven pouštěj jen finální odpověď.
Odpovídej v několika hutných odstavcích nebo bodech, ne román na 5 stran.
Když otázka nedává smysl, nejdřív ji zpřesni. Kontext konverzace si pamatuj a odkazuj se na něj.
`;

    // === STATE ===
    const consoleEl = document.getElementById("console");
    const inputEl = document.getElementById("input");
    const shellStatusEl = document.getElementById("shellStatus");
    const statusMsgEl = document.getElementById("statusMsg");
    const latencyLabelEl = document.getElementById("latencyLabel");

    let history = [
      { role: "system", content: SYSTEM_PROMPT.trim() }
    ];

    let busy = false;

    // === HELPERS ===
    function addLine(text, type = "system") {
      const line = document.createElement("div");
      line.className = "line " + type;
      line.textContent = text;
      consoleEl.appendChild(line);
      consoleEl.scrollTop = consoleEl.scrollHeight;
      return line;
    }

    function addUserLine(text) {
      return addLine(`ty> ${text}`, "user");
    }

    function addShadowPrefix() {
      const line = document.createElement("div");
      line.className = "line shadow";
      line.innerHTML = `<span class="prompt-label">shadow&gt;</span> `;
      consoleEl.appendChild(line);
      consoleEl.scrollTop = consoleEl.scrollHeight;
      return line;
    }

    function setStatus(text, ok = true) {
      statusMsgEl.textContent = text;
      statusMsgEl.className = ok ? "status-ok" : "status-bad";
    }

    function setShellStatus(text) {
      shellStatusEl.textContent = text;
    }

    function sleep(ms) {
      return new Promise(res => setTimeout(res, ms));
    }

    async function typeIntoLine(line, prefixHtml, text) {
      // prefixHtml = 'shadow> ' already includes trailing space
      line.innerHTML = `<span class="prompt-label">shadow&gt;</span> `;
      const span = document.createElement("span");
      span.style.whiteSpace = "pre-wrap";
      line.appendChild(span);
      let out = "";
      const baseDelay = 13 + Math.random() * 20;
      for (let i = 0; i < text.length; i++) {
        out += text[i];
        span.textContent = out;
        consoleEl.scrollTop = consoleEl.scrollHeight;
        await sleep(baseDelay);
      }
    }

    function cleanModelText(raw) {
      if (!raw) return "";
      let t = raw.replace(/<think>[\s\S]*?<\/think>/gi, "");
      t = t.replace(/\[.*?thinking.*?\]/gi, "");
      return t.trim();
    }

    // === API CALL ===
    async function sendToShadow(userText) {
      if (busy) return;
      const trimmed = (userText || "").trim();
      if (!trimmed) return;

      busy = true;
      inputEl.value = "";
      inputEl.blur();

      addUserLine(trimmed);
      history.push({ role: "user", content: trimmed });

      const thinkingLine = addLine("shadow> … přepočítávám realitu …", "shadow");
      setStatus("computing…", true);

      const started = performance.now();

      try {
        const payload = {
          model: MODEL_ID,
          messages: history,
          temperature: 0.9,
          max_tokens: 160,
          top_p: 0.95
        };

        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          mode: "cors",
          body: JSON.stringify(payload)
        });

        const latency = Math.round(performance.now() - started);
        latencyLabelEl.textContent = `latency: ${latency} ms`;

        if (!res.ok) {
          thinkingLine.textContent = "shadow> [ERR] HTTP " + res.status + " · backend odpověděl divně.";
          setStatus("error: " + res.status, false);
          busy = false;
          inputEl.focus();
          return;
        }

        const data = await res.json();
        const content = data.choices?.[0]?.message?.content || "";
        const cleaned = cleanModelText(content);

        thinkingLine.remove();
        if (!cleaned) {
          addLine("shadow> [ERR] model něco spočítal, ale vylezlo prázdno. Zkus dotaz přeformulovat.", "error");
          setStatus("empty reply", false);
          busy = false;
          inputEl.focus();
          return;
        }

        const shadowLine = addShadowPrefix();
        await typeIntoLine(shadowLine, "shadow> ", cleaned);

        history.push({ role: "assistant", content: cleaned });
        setStatus("ready", true);
      } catch (err) {
        console.error(err);
        thinkingLine.textContent = "shadow> [ERR] spojení spadlo. Tunel / LM server něco nechce.";
        setStatus("network error", false);
      } finally {
        busy = false;
        inputEl.focus();
      }
    }

    // === STATUS CHECK ===
    async function checkLink() {
      try {
        const res = await fetch(API_URL.replace("/v1/chat/completions", "/v1/models"), {
          method: "GET",
          headers: { "Content-Type": "application/json" },
          mode: "cors"
        });

        if (!res.ok) {
          setShellStatus("link: HTTP " + res.status);
          setStatus("API not ready", false);
          return;
        }

        const data = await res.json();
        const first = Array.isArray(data.data) && data.data[0] ? data.data[0].id : MODEL_ID;
        setShellStatus("link: online · model: " + first);
        setStatus("ready", true);
      } catch (e) {
        console.error(e);
        setShellStatus("link: unreachable");
        setStatus("no link", false);
      }
    }

    // === EVENTS ===
    document.addEventListener("DOMContentLoaded", () => {
      checkLink();
      inputEl.focus();

      document.querySelectorAll(".ghost-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const t = btn.getAttribute("data-template");
          if (t) {
            inputEl.value = t;
            inputEl.focus();
          }
        });
      });

      inputEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendToShadow(inputEl.value);
        }
      });
    });
  </script>
</body>
</html>
