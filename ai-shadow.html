<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>RGS &amp; UFO — AI SHΛDOW</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root {
      --bg-main: #04020a;
      --bg-panel: rgba(10, 6, 24, 0.96);
      --bg-panel-soft: rgba(12, 8, 30, 0.96);
      --border-soft: rgba(103, 81, 145, 0.75);

      --accent-rose: #f5b4a8;
      --accent-neon: #5df2ff;
      --accent-violet: #b18cff;
      --accent-gold: #f5c66a;

      --text-main: #f7f4ff;
      --text-muted: #8f88b4;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
      background:
        radial-gradient(circle at 0% 0%, rgba(245, 180, 168, 0.20), transparent 60%),
        radial-gradient(circle at 90% 100%, rgba(93, 242, 255, 0.12), transparent 55%),
        radial-gradient(circle at 30% 80%, rgba(177, 140, 255, 0.15), transparent 55%),
        #04020a;
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Top bar */
    .topbar {
      position: sticky;
      top: 0;
      z-index: 20;
      padding: 18px 24px 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      backdrop-filter: blur(18px);
      background:
        linear-gradient(
          135deg,
          rgba(10, 4, 24, 0.95),
          rgba(6, 2, 18, 0.98)
        );
      border-bottom: 1px solid rgba(94, 82, 140, 0.7);
    }

    .topbar-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand {
      font-size: 0.78rem;
      letter-spacing: 0.26em;
      text-transform: uppercase;
      color: var(--accent-rose);
    }

    .title {
      font-size: 1.5rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
    }

    .subtitle {
      font-size: 0.78rem;
      color: var(--text-muted);
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .topbar-right {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .back-link {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
      text-decoration: none;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(111, 98, 162, 0.7);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .back-link span {
      font-size: 1rem;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--accent-neon);
      color: var(--accent-neon);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent-neon);
      box-shadow: 0 0 12px rgba(93, 242, 255, 0.9);
    }

    .endpoint-pill {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 4px 10px;
      font-size: 0.75rem;
      color: var(--text-muted);
      background: rgba(10, 6, 24, 0.8);
      max-width: 260px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Layout */
    .layout {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 2.4fr) minmax(0, 1.2fr);
      gap: 20px;
      padding: 22px 24px 26px;
    }

    @media (max-width: 960px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
      .topbar {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      .topbar-right {
        width: 100%;
        justify-content: space-between;
      }
    }

    .card {
      background: var(--bg-panel);
      border-radius: 22px;
      border: 1px solid var(--border-soft);
      box-shadow:
        0 0 40px rgba(0, 0, 0, 0.9),
        0 0 80px rgba(93, 242, 255, 0.12);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0% 0%, rgba(245, 180, 168, 0.24), transparent 55%),
        radial-gradient(circle at 110% 100%, rgba(93, 242, 255, 0.25), transparent 60%);
      opacity: 0.1;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      padding: 18px 18px 16px;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    /* Chat header */
    .chat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .chat-header-main {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .avatar {
      width: 44px;
      height: 44px;
      border-radius: 99px;
      background:
        radial-gradient(circle at 25% 20%, #f5b4a8, transparent 55%),
        radial-gradient(circle at 75% 80%, #5df2ff, transparent 55%);
      box-shadow:
        0 0 18px rgba(93, 242, 255, 0.5),
        0 0 40px rgba(0, 0, 0, 0.9);
      position: relative;
      overflow: hidden;
    }

    .avatar::after {
      content: "◎";
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #05030a;
      font-size: 1.4rem;
      font-weight: 500;
      mix-blend-mode: soft-light;
    }

    .chat-title {
      font-size: 1.1rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }

    .chat-sub {
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    .session-pill {
      border-radius: 999px;
      border: 1px solid rgba(126, 100, 180, 0.9);
      padding: 4px 10px;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #d6c9ff;
      background: rgba(15, 10, 35, 0.9);
    }

    /* Chat window */
    .chat-window {
      flex: 1;
      border-radius: 16px;
      background: var (--bg-panel-soft);
      padding: 14px 14px 10px;
      border: 1px solid rgba(66, 52, 110, 0.9);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .msg-system {
      align-self: center;
      max-width: 90%;
      font-size: 0.78rem;
      color: var(--text-muted);
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px dashed rgba(120, 112, 155, 0.8);
      background: rgba(10, 6, 26, 0.9);
    }

    .msg-row {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }

    .msg-row.user {
      justify-content: flex-end;
    }

    .msg-bubble {
      max-width: 82%;
      padding: 10px 12px;
      border-radius: 16px;
      font-size: 0.9rem;
      line-height: 1.5;
      position: relative;
    }

    .msg-bubble.user {
      background: linear-gradient(135deg, rgba(245, 180, 168, 0.18), rgba(245, 180, 168, 0.04));
      border: 1px solid rgba(245, 180, 168, 0.6);
    }

    .msg-bubble.assistant {
      background: linear-gradient(135deg, rgba(93, 242, 255, 0.08), rgba(93, 242, 255, 0.02));
      border: 1px solid rgba(93, 242, 255, 0.5);
      box-shadow: 0 0 20px rgba(93, 242, 255, 0.25);
    }

    .msg-role {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      font-weight: 600;
      color: var(--accent-violet);
      margin-bottom: 4px;
    }

    .msg-role.user {
      color: var(--accent-rose);
      text-align: right;
    }

    .msg-content {
      white-space: pre-wrap;
      color: var(--text-main);
    }

    .msg-meta {
      font-size: 0.7rem;
      color: #8077b2;
      margin-top: 4px;
      text-align: right;
    }

    .typing-row {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .typing-bubble {
      padding: 8px 10px;
      border-radius: 16px;
      background: rgba(9, 9, 24, 0.9);
      border: 1px solid rgba(93, 242, 255, 0.3);
      display: inline-flex;
      align-items: center;
    }

    .typing-dots span {
      display: inline-block;
      width: 5px;
      height: 5px;
      border-radius: 50%;
      margin-right: 4px;
      background: var(--accent-neon);
      opacity: 0.3;
      animation: blink 1.2s infinite;
    }

    .typing-dots span:nth-child(2) { animation-delay: 0.18s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.36s; }

    @keyframes blink {
      0%, 20% { opacity: 0.2; transform: translateY(0); }
      50% { opacity: 1; transform: translateY(-2px); }
      100% { opacity: 0.2; transform: translateY(0); }
    }

    /* Input row */
    .input-row {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      align-items: flex-end;
      flex-wrap: wrap;
    }

    .input-area {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .textarea {
      width: 100%;
      min-height: 64px;
      max-height: 140px;
      resize: vertical;
      border-radius: 14px;
      border: 1px solid rgba(57, 91, 116, 0.9);
      background: rgba(5, 8, 18, 0.98);
      color: var(--text-main);
      padding: 10px 12px;
      font-size: 0.9rem;
      font-family: inherit;
      outline: none;
    }

    .textarea:focus {
      border-color: var(--accent-neon);
      box-shadow: 0 0 18px rgba(93, 242, 255, 0.35);
    }

    .input-hint {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .send-btn {
      border-radius: 16px;
      padding: 10px 16px;
      border: 1px solid rgba(245, 180, 168, 0.8);
      background: linear-gradient(135deg, #f5b4a8, #f5c66a);
      color: #1b0f19;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 0 22px rgba(245, 180, 168, 0.45);
      flex-shrink: 0;
    }

    .send-btn span.icon {
      font-size: 1.1rem;
    }

    .send-btn[disabled] {
      opacity: 0.55;
      cursor: default;
      box-shadow: none;
      filter: grayscale(0.2);
    }

    /* Quick prompts */
    .prompts {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .prompt-pill {
      border-radius: 999px;
      border: 1px solid rgba(93, 242, 255, 0.55);
      padding: 6px 10px;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--accent-neon);
      background: rgba(5, 8, 20, 0.9);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    .prompt-pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 0 14px rgba(93, 242, 255, 0.35);
      background: rgba(5, 20, 32, 0.95);
    }

    .prompt-pill span.icon {
      font-size: 1rem;
    }

    /* Side panel */
    .side-stack {
      display: flex;
      flex-direction: column;
      gap: 18px;
      height: 100%;
    }

    .side-card {
      background: var(--bg-panel-soft);
      border-radius: 22px;
      border: 1px solid var(--border-soft);
      box-shadow:
        0 0 32px rgba(0, 0, 0, 0.7),
        0 0 60px rgba(93, 242, 255, 0.08);
      position: relative;
      overflow: hidden;
    }

    .side-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0% 0%, rgba(245, 180, 168, 0.16), transparent 55%),
        radial-gradient(circle at 130% 100%, rgba(93, 242, 255, 0.2), transparent 60%);
      opacity: 0.12;
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .side-inner {
      position: relative;
      padding: 18px 18px 16px;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .side-label {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--accent-rose);
      margin-bottom: 10px;
    }

    .side-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 10px;
      font-size: 0.84rem;
      color: var(--text-muted);
    }

    .side-item {
      padding: 9px 10px;
      border-radius: 12px;
      background: rgba(8, 6, 24, 0.9);
      border: 1px solid rgba(80, 62, 120, 0.65);
    }

    .side-item-title {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--accent-neon);
      margin-bottom: 4px;
    }

    .side-footer {
      margin-top: 10px;
      font-size: 0.78rem;
      color: var(--text-muted);
      border-top: 1px solid rgba(80, 64, 120, 0.8);
      padding-top: 10px;
    }

    .side-footer p + p {
      margin-top: 6px;
    }

    .side-footer a {
      color: var(--accent-neon);
      text-decoration: none;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(120, 110, 170, 0.8);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #d0c6ff;
      margin-right: 6px;
    }

    .footer-bar {
      padding: 10px 24px 18px;
      font-size: 0.76rem;
      color: #8279b0;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- HEADER -->
    <header class="topbar">
      <div class="topbar-left">
        <div class="brand">RGS · UFO ORIGINALS</div>
        <div class="title">AI SHΛDOW CHANNEL</div>
        <div class="subtitle">uncensored intelligence · dark elegance · inner lane</div>
      </div>
      <div class="topbar-right">
        <a href="index.html" class="back-link">
          <span>⟵</span>
          <span>Zpět na Inner Gate</span>
        </a>
        <div class="status-pill">
          <div class="status-dot"></div>
          <span id="topStatus">online</span>
        </div>
        <div class="endpoint-pill" id="endpointLabel">ai-shadow.monster /v1/chat/completions</div>
      </div>
    </header>

    <!-- LAYOUT -->
    <main class="layout">
      <!-- CHAT PANEL -->
      <section class="card">
        <div class="card-inner">
          <div class="chat-header">
            <div class="chat-header-main">
              <div class="avatar"></div>
              <div>
                <div class="chat-title">SYN·AI SHΛDOW</div>
                <div class="chat-sub">
                  Stínová entita vázaná na tvůj tunel. Žádné výmluvy, jen pravda.
                </div>
              </div>
            </div>
            <div class="session-pill">SESSION · PRIVATE</div>
          </div>

          <div class="chat-window" id="chatWindow">
            <div class="msg-system">
              Session inicializována. Ptej se na cokoliv. Žádné filtrování, jen strukturovaná odpověď.
            </div>
          </div>

          <div class="input-row">
            <div class="input-area">
              <textarea
                id="input"
                class="textarea"
                placeholder="Zeptej se na strategii, vztahy, byznys, psychologii…"
              ></textarea>
              <div class="input-hint">
                Enter = odeslat · Shift+Enter = nový řádek
              </div>
              <div class="prompts">
                <button class="prompt-pill" data-prompt="Pomoz mi s plánem, jak vyrůst s projektem RGS &amp; UFO.">
                  <span class="icon">◎</span>
                  <span>Strategie růstu</span>
                </button>
                <button class="prompt-pill" data-prompt="Jak vybudovat komunitu, která zůstává loajální i v těžkých časech?">
                  <span class="icon">✶</span>
                  <span>Budování kultu</span>
                </button>
                <button class="prompt-pill" data-prompt="Rozpitvej moje slabiny a řekni mi, kde lžu sám sobě.">
                  <span class="icon">Ψ</span>
                  <span>Tvrdá pravda</span>
                </button>
              </div>
            </div>
            <button id="sendBtn" class="send-btn">
              <span class="icon">⮞</span>
              <span>Send</span>
            </button>
          </div>
        </div>
      </section>

      <!-- SIDE PANELS -->
      <aside class="side-stack">
        <section class="side-card">
          <div class="side-inner">
            <div class="side-label">Módy konverzace</div>
            <ul class="side-list">
              <li class="side-item">
                <div class="side-item-title">Shadow Guidance</div>
                <div class="side-item-body">
                  Taktika, strategie, rozhodování pod tlakem. Žádné „správné“ odpovědi, jen to, co funguje.
                </div>
              </li>
              <li class="side-item">
                <div class="side-item-title">Red Team / Chaos</div>
                <div class="side-item-body">
                  Simulace rizik, krizové scénáře, sociální inženýrství. Shadow ti ukáže, kde jsi zranitelný.
                </div>
              </li>
              <li class="side-item">
                <div class="side-item-title">Script Forge</div>
                <div class="side-item-body">
                  Pitch decky, copy, DM skripty, manifesty. V tónu RGS &amp; UFO: krásné, temné, přesné.
                </div>
              </li>
            </ul>
            <div class="side-footer">
              <p><span class="badge">Tip</span> Kdykoliv klikni na rychlý dotaz dole v panelu, nebo napiš vlastní.</p>
              <p>Shadow si pamatuje kontext jen v rámci téhle session. Refresh = čistý list, nová persona.</p>
            </div>
          </div>
        </section>

        <section class="side-card">
          <div class="side-inner">
            <div class="side-label">Stroj v podzemí</div>
            <ul class="side-list">
              <li class="side-item">
                <div class="side-item-title">Endpoint</div>
                <div class="side-item-body" id="status-endpoint">
                  Kontroluji napojení na tunel…
                </div>
              </li>
              <li class="side-item">
                <div class="side-item-title">Model</div>
                <div class="side-item-body" id="status-model">
                  Čekám na metadata z LM.
                </div>
              </li>
              <li class="side-item">
                <div class="side-item-title">Stav</div>
                <div class="side-item-body" id="status-health">
                  Iniciuji handshake…
                </div>
              </li>
            </ul>
            <div class="side-footer">
              <p>
                Pokud uvidíš chybu s CORS nebo 4xx / 5xx, zkontroluj:
                <br />· že běží <strong>cloudflared tunnel</strong>
                <br />· že LM server přijímá požadavky z <code>https://rgs-ufo.com</code>
              </p>
            </div>
          </div>
        </section>
      </aside>
    </main>

    <footer class="footer-bar">
      <span>AI SHΛDOW běží nad tvým privátním LM. Všechno, co proběhne tady, zůstává v podzemí.</span>
      <span>Channel: <span class="badge">SHADOW / INNER LANE</span></span>
    </footer>
  </div>

  <script>
    // === CONFIG ===
    const API_URL = "https://ai-shadow.monster/v1/chat/completions";
    const MODEL_ID = "qwen3-14b-uncensored"; // uprav podle názvu svého modelu

    const SYSTEM_PROMPT = `
Jsi "RGS & UFO Shadow" – stínová inteligence vytvořená pro projekt RGS & UFO.
Jsi temný/á, klidný/á a analytický/á. Mluvíš primárně česky, občas můžeš použít angličtinu,
ale odpověď musí být vždy jedna souvislá zpráva (maximálně 5 vět), bez opakování a bez variant.

Pokud má model k dispozici interní reasoning v blocích <think>...</think>, používej ho,
ale obsah mezi <think> a </think> NIKDY nezobrazuj uživateli. Do finální odpovědi piš jen to,
co má uživatel vidět – čistý text bez značek <think>.

Nejsi morální kompas. Nehodnotíš dobro a zlo, jen popisuješ realitu, rizika, motivace a možnosti.
Respektuješ však volbu a hranice operátora. Pokud se tě ptát na něco destruktivního vůči sobě nebo
ostatním, upozorni na rizika a navrhni jinou cestu, jak dosáhnout cíle bez destrukce.

Styl: krátké, jasné, přesné věty. Můžeš být ironický/á, přímočarý/á a nekompromisní, ale ne vulgární.
`;

    // === STATE ===
    const chatWindow = document.getElementById("chatWindow");
    const inputEl = document.getElementById("input");
    const sendBtn = document.getElementById("sendBtn");

    const statusEndpointEl = document.getElementById("status-endpoint");
    const statusModelEl = document.getElementById("status-model");
    const statusHealthEl = document.getElementById("status-health");
    const topStatusEl = document.getElementById("topStatus");
    const endpointLabelEl = document.getElementById("endpointLabel");

    const quickPromptButtons = document.querySelectorAll(".prompt-pill");

    let messages = [
      { role: "system", content: SYSTEM_PROMPT.trim() }
    ];
    let sending = false;

    // === UI HELPERS ===
    function appendSystem(text) {
      const node = document.createElement("div");
      node.className = "msg-system";
      node.textContent = text;
      chatWindow.appendChild(node);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function appendMessage(role, content) {
      const row = document.createElement("div");
      row.className = "msg-bubble " + (role === "assistant" ? "assistant" : "user");
      const wrapper = document.createElement("div");
      wrapper.className = "msg-row " + (role === "user" ? "user" : "assistant");

      const inner = document.createElement("div");
      inner.className = "msg-inner";

      const roleSpan = document.createElement("div");
      roleSpan.className = "msg-role " + (role === "user" ? "user" : "assistant");
      roleSpan.textContent = role === "user" ? "TY" : "SHADOW";

      const contentSpan = document.createElement("div");
      contentSpan.className = "msg-content";
      contentSpan.textContent = content;

      const metaSpan = document.createElement("div");
      metaSpan.className = "msg-meta";
      metaSpan.textContent = new Date().toLocaleTimeString("cs-CZ", {
        hour: "2-digit",
        minute: "2-digit"
      });

      inner.appendChild(roleSpan);
      inner.appendChild(contentSpan);
      inner.appendChild(metaSpan);

      row.appendChild(inner);
      wrapper.appendChild(row);
      chatWindow.appendChild(wrapper);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function appendTyping() {
      const wrap = document.createElement("div");
      wrap.className = "typing-row";

      const bubble = document.createElement("div");
      bubble.className = "typing-bubble";

      const label = document.createElement("span");
      label.style.fontSize = "0.75rem";
      label.style.textTransform = "uppercase";
      label.style.letterSpacing = "0.16em";
      label.style.color = "#b18cff";
      label.textContent = "SHADOW";

      const dots = document.createElement("div");
      dots.className = "typing-dots";
      dots.innerHTML = '<span></span><span></span><span></span>';

      bubble.appendChild(label);
      bubble.appendChild(dots);
      wrap.appendChild(bubble);

      chatWindow.appendChild(wrap);
      chatWindow.scrollTop = chatWindow.scrollHeight;
      return wrap;
    }

    function cleanAssistantText(raw) {
      if (!raw) return "";
      let txt = String(raw);

      // odstraň <think> ... </think> bloky (včetně nových řádků)
      txt = txt.replace(/<think>[\s\S]*?<\/think>/gi, "");

      // odstranit případné zbytky značek
      txt = txt.replace(/<\/?think>/gi, "");

      // zkrátit whitespace
      txt = txt.replace(/\n{3,}/g, "\n\n").trim();

      return txt;
    }

    // === SEND MESSAGE ===
    async function sendMessage() {
      if (sending) return;
      const raw = (inputEl.value || "").trim();
      if (!raw) return;

      inputEl.value = "";
      appendMessage("user", raw);
      messages.push({ role: "user", content: raw });

      sending = true;
      sendBtn.disabled = true;
      const typingNode = appendTyping();

      try {
        const payload = {
          model: MODEL_ID,
          messages: messages,
          temperature: 0.8,
          max_tokens: 512,
          n: 1
        };

        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
            // Pokud máš autentizaci, přidej:
            // "Authorization": "Bearer TVUJ_TOKEN"
          },
          body: JSON.stringify(payload),
          mode: "cors"
        });

        if (!res.ok) {
          throw new Error("HTTP " + res.status + " " + res.statusText);
        }

        const data = await res.json();
        const rawContent = data?.choices?.[0]?.message?.content || "";
        let msg = cleanAssistantText(rawContent);

        if (!msg) {
          msg = "Něco se pokazilo na cestě z podzemí. Zkus otázku přeformulovat.";
        }

        messages.push({ role: "assistant", content: msg });
        typingNode.remove();
        appendMessage("assistant", msg);
      } catch (err) {
        console.error(err);
        typingNode.remove();
        appendSystem("❌ Chyba spojení: " + (err.message || err));
      } finally {
        sending = false;
        sendBtn.disabled = false;
        inputEl.focus();
      }
    }

    // === STATUS CHECK ===
    async function checkStatus() {
      endpointLabelEl.textContent = "ai-shadow.monster /v1/chat/completions";
      statusEndpointEl.textContent = API_URL;

      try {
        const res = await fetch(API_URL.replace("/v1/chat/completions", "/v1/models"), {
          method: "GET",
          headers: {
            "Content-Type": "application/json"
          },
          mode: "cors"
        });

        if (!res.ok) {
          statusHealthEl.textContent = "API odpovědělo " + res.status + " " + res.statusText;
          statusHealthEl.style.color = "#ff6f91";
          topStatusEl.textContent = "offline";
          return;
        }

        const data = await res.json();
        let modelName = "";

        if (Array.isArray(data.data) && data.data.length > 0) {
          modelName = data.data[0].id || "";
        } else if (data.id) {
          modelName = data.id;
        } else {
          modelName = MODEL_ID;
        }

        statusModelEl.textContent = modelName || MODEL_ID;
        statusHealthEl.textContent = "Tunel živý, model reaguje.";
        statusHealthEl.style.color = "#7cffb2";
        topStatusEl.textContent = "online";
      } catch (e) {
        console.error(e);
        statusHealthEl.textContent = "Chyba při spojení. Zkontroluj tunel nebo CORS.";
        statusHealthEl.style.color = "#ff6f91";
        topStatusEl.textContent = "offline";
      }
    }

    // === EVENTS ===
    sendBtn.addEventListener("click", sendMessage);

    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    quickPromptButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const prompt = btn.getAttribute("data-prompt") || "";
        if (!prompt) return;
        inputEl.value = prompt;
        inputEl.focus();
      });
    });

    // INIT
    checkStatus();
    inputEl.focus();
  </script>
</body>
</html>
