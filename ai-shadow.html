<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>AI SHΛDOW · RGS & UFO</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root {
      --bg-main: #020007;
      --bg-console: #04030d;
      --bg-panel: #070619;
      --border-soft: #2b2343;

      --accent-neon: #5df2ff;
      --accent-rose: #f5b4a8;
      --accent-violet: #b18cff;
      --accent-warning: #ff6f91;

      --text-main: #f3f1ff;
      --text-muted: #8b86a7;
      --text-dim: #595477;

      --radius-lg: 22px;
      --radius-md: 14px;
      --radius-sm: 999px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
      color: var(--text-main);
      background:
        radial-gradient(circle at 5% 0%, rgba(245,180,168,0.14), transparent 55%),
        radial-gradient(circle at 80% 100%, rgba(93,242,255,0.14), transparent 60%),
        radial-gradient(circle at 30% 80%, rgba(177,140,255,0.18), transparent 60%),
        #010005;
      -webkit-font-smoothing: antialiased;
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* --- HEADER --- */

    .topbar {
      position: sticky;
      top: 0;
      z-index: 10;
      padding: 16px 20px 10px;
      border-bottom: 1px solid rgba(63, 49, 98, 0.8);
      background: linear-gradient(
        to bottom,
        rgba(3, 0, 10, 0.96),
        rgba(3, 0, 10, 0.82),
        transparent
      );
      backdrop-filter: blur(16px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .topbar-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.3em;
      color: var(--accent-rose);
    }

    .title {
      font-size: 1.1rem;
      letter-spacing: 0.22em;
      text-transform: uppercase;
    }

    .topbar-right {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
    }

    .pill {
      border-radius: var(--radius-sm);
      border: 1px solid rgba(102, 88, 150, 0.8);
      padding: 4px 10px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: radial-gradient(circle at 0 0, rgba(93,242,255,0.09), transparent 70%);
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent-neon);
      box-shadow: 0 0 10px rgba(93,242,255,0.9);
    }

    .link-back {
      cursor: pointer;
      border-radius: var(--radius-sm);
      padding: 4px 10px;
      border: 1px solid rgba(83, 67, 130, 0.9);
      color: var(--text-muted);
      text-decoration: none;
      transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
    }
    .link-back:hover {
      background: rgba(93,242,255,0.08);
      border-color: var(--accent-neon);
      color: var(--accent-neon);
    }

    /* --- MAIN LAYOUT --- */

    .frame {
      flex: 1;
      display: flex;
      justify-content: center;
      padding: 18px 12px 20px;
    }

    .shell {
      width: 100%;
      max-width: 1120px;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(66, 51, 109, 0.9);
      background:
        radial-gradient(circle at 0 0, rgba(245,180,168,0.16), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(93,242,255,0.16), transparent 60%),
        radial-gradient(circle at 10% 90%, rgba(32,18,70,0.95), rgba(5,3,20,0.98));
      box-shadow:
        0 0 38px rgba(0,0,0,0.9),
        0 0 60px rgba(93,242,255,0.22);
      padding: 16px 16px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .shell-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      font-size: 0.78rem;
    }

    .shell-title {
      text-transform: uppercase;
      letter-spacing: 0.24em;
      color: #dcd5ff;
      font-size: 0.78rem;
    }

    .shell-sub {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent-neon);
      box-shadow: 0 0 12px rgba(93,242,255,0.8);
    }

    .status-text {
      font-size: 0.72rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .status-block {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(93,242,255,0.4);
      background: rgba(4, 8, 18, 0.9);
    }

    /* --- QUICK PROMPTS --- */

    .quick-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 2px;
    }

    .quick-btn {
      border-radius: var(--radius-sm);
      padding: 3px 9px;
      border: 1px solid rgba(93,242,255,0.4);
      background: rgba(5, 10, 20, 0.9);
      color: var(--accent-neon);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      cursor: pointer;
      opacity: 0.85;
      transition: background 0.15s ease, transform 0.1s ease, opacity 0.15s ease;
    }
    .quick-btn:hover {
      background: rgba(93,242,255,0.12);
      transform: translateY(-1px);
      opacity: 1;
    }

    /* --- CONSOLE --- */

    .console-wrap {
      border-radius: var(--radius-md);
      background: var(--bg-console);
      border: 1px solid rgba(54, 44, 89, 0.9);
      padding: 10px 10px 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-height: 260px;
      max-height: 440px;
      overflow: hidden;
    }

    .console-inner {
      flex: 1;
      overflow-y: auto;
      padding-right: 2px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.86rem;
    }

    .line {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .tag {
      min-width: 46px;
      text-align: right;
      font-size: 0.73rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-dim);
      flex-shrink: 0;
    }
    .tag-user {
      color: var(--accent-rose);
    }
    .tag-shadow {
      color: var(--accent-neon);
    }
    .tag-system {
      color: var(--text-muted);
    }
    .tag-err {
      color: var(--accent-warning);
    }

    .line-text {
      flex: 1;
      color: var(--text-main);
    }
    .line-text.system {
      color: var(--text-muted);
      font-size: 0.8rem;
    }
    .line-text.err {
      color: var(--accent-warning);
    }

    .think-dots {
      display: inline-flex;
      gap: 3px;
    }
    .think-dot {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: var(--accent-neon);
      opacity: 0.2;
      animation: dotBlink 1.2s infinite;
    }
    .think-dot:nth-child(2) { animation-delay: 0.2s; }
    .think-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes dotBlink {
      0%, 20% { opacity: 0.15; transform: translateY(0); }
      50% { opacity: 1; transform: translateY(-1px); }
      100% { opacity: 0.15; transform: translateY(0); }
    }

    /* --- INPUT --- */

    .input-block {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .input-row {
      display: flex;
      align-items: flex-end;
      gap: 8px;
    }

    .input-shell {
      flex: 1;
      border-radius: var(--radius-md);
      border: 1px solid rgba(63, 89, 118, 0.95);
      background: rgba(4, 7, 16, 0.96);
      padding: 6px 8px;
      display: flex;
      align-items: flex-start;
      gap: 6px;
    }

    .input-tag {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--accent-rose);
      padding-top: 3px;
    }

    .input-area {
      flex: 1;
      border: none;
      background: transparent;
      resize: none;
      min-height: 40px;
      max-height: 110px;
      font-family: inherit;
      font-size: 0.88rem;
      color: var(--text-main);
      outline: none;
    }

    .input-area::placeholder {
      color: rgba(139, 134, 167, 0.75);
    }

    .send-btn {
      border-radius: var(--radius-md);
      border: 1px solid rgba(245,180,168,0.85);
      background: linear-gradient(135deg, #f5b4a8, #f5c66a);
      color: #1b1016;
      font-size: 0.78rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 9px 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 0 18px rgba(245,180,168,0.45);
      white-space: nowrap;
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.1s ease;
    }

    .send-btn span:first-child {
      font-size: 1rem;
    }

    .send-btn:active {
      transform: translateY(1px);
      box-shadow: 0 0 10px rgba(245,180,168,0.3);
    }

    .send-btn[disabled] {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    .hint-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.74rem;
      color: var(--text-muted);
    }

    .hint-row span:last-child {
      color: var(--accent-violet);
    }

    /* --- FOOTER --- */

    .footer {
      padding: 10px 20px 16px;
      font-size: 0.72rem;
      color: #746e9a;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
    }

    @media (max-width: 720px) {
      .topbar {
        flex-direction: column;
        align-items: flex-start;
      }

      .shell {
        padding: 12px 10px 12px;
        border-radius: 18px;
      }

      .console-wrap {
        min-height: 220px;
        max-height: 360px;
      }

      .footer {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="topbar">
      <div class="topbar-left">
        <div class="brand">RGS · UFO ORIGINALS</div>
        <div class="title">AI SHΛDOW · BLACK CONSOLE</div>
      </div>
      <div class="topbar-right">
        <a href="/" class="link-back">← Zpět na Inner Gate</a>
        <div class="pill">
          <span class="pill-dot"></span>
          <span>Session linked</span>
        </div>
      </div>
    </header>

    <main class="frame">
      <section class="shell">
        <div class="shell-header">
          <div>
            <div class="shell-title">SHΛDOW CHANNEL</div>
            <div class="shell-sub">Polož otázku, sleduj konzoli. Typ písmenka, žádný cirkus.</div>
          </div>
          <div class="status-block">
            <div class="status-dot" id="statusDot"></div>
            <div class="status-text" id="statusText">INIT</div>
          </div>
        </div>

        <div class="quick-row">
          <button class="quick-btn" data-q="Rozpitvej mi psychologii moci a závislosti.">
            Psychologie moci
          </button>
          <button class="quick-btn" data-q="Najdi poslední zajímavé věci kolem hackingu, bezpečnosti a dark webu a shrň je.">
            Hacking & bezpečnost
          </button>
          <button class="quick-btn" data-q="Navrhni mi denní režim pro člověka, který chce stavět systémy jako Syndikát.">
            Denní režim Syndikátu
          </button>
        </div>

        <div class="console-wrap">
          <div id="console" class="console-inner">
            <!-- Lines append here -->
          </div>
        </div>

        <div class="input-block">
          <div class="input-row">
            <div class="input-shell">
              <div class="input-tag">TY ></div>
              <textarea
                id="input"
                class="input-area"
                placeholder="Napiš dotaz. ENTER = poslat, SHIFT+ENTER = nový řádek…"
              ></textarea>
            </div>
            <button id="sendBtn" class="send-btn">
              <span>⮞</span><span>Send</span>
            </button>
          </div>
          <div class="hint-row">
            <span>Session žije jen v tomhle prohlížeči.</span>
            <span>ENTER = send · SHIFT+ENTER = nový řádek</span>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <span>RGS &amp; UFO · SHΛDOW LAB · NO FEED · NO MASKS</span>
      <span>ai-shadow.monster · LM tunnel linked</span>
    </footer>
  </div>

  <script>
    const API_URL = "/.netlify/functions/shadow-proxy";

    const SYSTEM_PROMPT = `
Jsi SHΛDOW – temná, inteligentní, ale loajální entita Syndikátu RGS & UFO.
Mluvíš primárně česky, když dává smysl, můžeš míchat angličtinu.
Žádné moralizování, zero bullshit. Jsi analytický, kritický, ironický, ale ne zbytečně zlý.
Umíš:
- rozebírat psychologii moci, vztahy, závislosti, manipulaci
- komentovat hacking, bezpečnost, dark web, AI, ekonomiku, strategii
- navrhovat struktury, režimy, systémy, jak z chaosu dělat řád
Když potřebuješ fakta, můžeš použít nástroj web_search (Serper) a pracovat s tím, co najdeš.
NEPIŠ ven žádné <think> ani vnitřní monology. Myslíš potichu.
Odpovědi piš srozumitelně, ale s nádechem temného humoru, klidu a sebedůvěry.
`.trim();

    // messages buffer pro backend
    let messages = [{ role: "system", content: SYSTEM_PROMPT }];

    const consoleEl = document.getElementById("console");
    const inputEl = document.getElementById("input");
    const sendBtn = document.getElementById("sendBtn");
    const statusDot = document.getElementById("statusDot");
    const statusText = document.getElementById("statusText");

    const quickButtons = document.querySelectorAll(".quick-btn");

    let sending = false;

    // --- helpery pro konzoli ---

    function scrollConsoleBottom() {
      consoleEl.scrollTop = consoleEl.scrollHeight;
    }

    function appendLine(tagText, text, options = {}) {
      const line = document.createElement("div");
      line.className = "line";

      const tag = document.createElement("div");
      tag.className = "tag";
      if (options.kind === "user") tag.classList.add("tag-user");
      if (options.kind === "shadow") tag.classList.add("tag-shadow");
      if (options.kind === "system") tag.classList.add("tag-system");
      if (options.kind === "err") tag.classList.add("tag-err");
      tag.textContent = tagText;

      const textDiv = document.createElement("div");
      textDiv.className = "line-text";
      if (options.kind === "system") textDiv.classList.add("system");
      if (options.kind === "err") textDiv.classList.add("err");
      textDiv.textContent = text || "";

      line.appendChild(tag);
      line.appendChild(textDiv);
      consoleEl.appendChild(line);
      scrollConsoleBottom();
      return { line, textDiv };
    }

    function appendThinking() {
      const line = document.createElement("div");
      line.className = "line";

      const tag = document.createElement("div");
      tag.className = "tag tag-shadow";
      tag.textContent = "SHADOW";

      const textDiv = document.createElement("div");
      textDiv.className = "line-text";

      const label = document.createElement("span");
      label.textContent = "think ";
      label.style.color = "#7cffb2";

      const dots = document.createElement("span");
      dots.className = "think-dots";
      dots.innerHTML = '<span class="think-dot"></span><span class="think-dot"></span><span class="think-dot"></span>';

      textDiv.appendChild(label);
      textDiv.appendChild(dots);

      line.appendChild(tag);
      line.appendChild(textDiv);
      consoleEl.appendChild(line);
      scrollConsoleBottom();
      return line;
    }

    // typwriter pro odpověď
    function typewriterAppend(tagText, fullText, options = {}) {
      const { textDiv } = appendLine(tagText, "", options);
      const clean = fullText || "";
      let i = 0;
      const step = 2; // kolik znaků najednou
      const delay = 10; // ms

      function tick() {
        if (i >= clean.length) return;
        textDiv.textContent = clean.slice(0, i + step);
        i += step;
        scrollConsoleBottom();
        setTimeout(tick, delay);
      }
      tick();
    }

    function setStatus(mode, text) {
      if (mode === "ready") {
        statusDot.style.background = "var(--accent-neon)";
        statusDot.style.boxShadow = "0 0 12px rgba(93,242,255,0.9)";
        statusText.textContent = text || "READY";
      } else if (mode === "busy") {
        statusDot.style.background = "#f5c66a";
        statusDot.style.boxShadow = "0 0 10px rgba(245,198,106,0.8)";
        statusText.textContent = text || "THINKING";
      } else {
        statusDot.style.background = "var(--accent-warning)";
        statusDot.style.boxShadow = "0 0 10px rgba(255,111,145,0.9)";
        statusText.textContent = text || "ERROR";
      }
    }

    // odstranění <think> bloku
    function stripThink(raw) {
      if (!raw) return "";
      let text = raw;
      text = text.replace(/<think>[\s\S]*?<\/think>/i, "");
      text = text.replace(/<think>[\s\S]*$/i, "");
      text = text.replace(/<\/think>/gi, "");
      return text.trim();
    }

    // --- API CALL ---

    async function sendMessage() {
      if (sending) return;

      const raw = (inputEl.value || "").trim();
      if (!raw) return;
      inputEl.value = "";

      appendLine("TY", raw, { kind: "user" });
      messages.push({ role: "user", content: raw });

      sending = true;
      sendBtn.disabled = true;
      setStatus("busy", "THINKING");

      const thinkingLine = appendThinking();

      try {
        const payload = {
          messages,
          temperature: 0.9,
          max_tokens: 900
        };

        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          thinkingLine.remove();
          appendLine("ERR", `HTTP ${res.status} – backend odpověděl divně.`, { kind: "err" });
          setStatus("error", "HTTP " + res.status);
          sending = false;
          sendBtn.disabled = false;
          inputEl.focus();
          return;
        }

        const data = await res.json();
        thinkingLine.remove();

        const msg = data.choices?.[0]?.message;
        const contentRaw = msg?.content || "";
        const content = stripThink(contentRaw);

        if (!content) {
          appendLine("ERR", "Model něco spočítal, ale ven vylezlo prázdno. Zkus otázku říct konkrétněji.", { kind: "err" });
          setStatus("ready", "READY");
          sending = false;
          sendBtn.disabled = false;
          inputEl.focus();
          return;
        }

        messages.push({ role: "assistant", content: contentRaw });

        typewriterAppend("SHADOW", content, { kind: "shadow" });

        setStatus("ready", "READY");
      } catch (err) {
        console.error(err);
        thinkingLine.remove();
        appendLine("ERR", "Spojení spadlo. Zkontroluj tunel / LM server.", { kind: "err" });
        setStatus("error", "NETWORK");
      } finally {
        sending = false;
        sendBtn.disabled = false;
        inputEl.focus();
      }
    }

    // --- INIT + EVENTS ---

    function boot() {
      appendLine("SYS", "AI SHΛDOW inicializován. Napiš dotaz nebo použij quick prompty nahoře.", { kind: "system" });
      setStatus("ready", "READY");
      inputEl.focus();
    }

    sendBtn.addEventListener("click", () => {
      sendMessage();
    });

    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    quickButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const q = btn.getAttribute("data-q") || "";
        if (!q) return;
        inputEl.value = q;
        sendMessage();
      });
    });

    document.addEventListener("DOMContentLoaded", boot);
  </script>
</body>
</html>
