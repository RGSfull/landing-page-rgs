<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>AI SHADOW · interactive shell</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root {
      --bg-main: #05040a;
      --bg-shell: #05040c;
      --bg-pane: #05050b;
      --bg-pane-side: #060611;
      --border-soft: #171626;
      --border-strong: #3c375c;

      --text-main: #f5f5ff;
      --text-muted: #8a869f;
      --text-soft: #5b5870;

      --user-color: #ff5f9a;
      --shadow-color: #5df2ff;
      --error-color: #ff6f6f;
      --system-color: #b0a7cf;

      --pill-bg: #090815;
      --pill-border: #413a6a;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background:
        radial-gradient(circle at 0 0, #271739 0, #05040a 45%),
        radial-gradient(circle at 100% 100%, #0c1224 0, #000000 55%),
        #000000;
      color: var(--text-main);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", "SF Pro Text", sans-serif;
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ── TOP BAR ───────────────────────────────── */

    .topbar {
      padding: 8px 16px 6px;
      border-bottom: 1px solid #141321;
      background: linear-gradient(to bottom, #070612, #05040a);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      font-family: "Consolas","Menlo","SF Mono",monospace;
      font-size: 0.78rem;
    }

    .tb-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .tb-title {
      text-transform: uppercase;
      letter-spacing: 0.26em;
      font-size: 0.8rem;
    }

    .tb-sub {
      color: var(--text-soft);
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .tb-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pill {
      border-radius: 999px;
      border: 1px solid var(--pill-border);
      background: var(--pill-bg);
      padding: 3px 9px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .pill .dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #29f7c3;
      box-shadow: 0 0 9px rgba(41,247,195,0.9);
    }

    .pill-link {
      cursor: pointer;
      border-color: #365d7a;
      color: #b8e7ff;
    }

    .pill-link:hover {
      background: #0a0918;
    }

    .status-label {
      color: #7cffb2;
    }

    @media (max-width: 880px) {
      .topbar {
        flex-direction: column;
        align-items: flex-start;
      }
      .tb-right {
        align-self: stretch;
        justify-content: space-between;
      }
    }

    /* ── SHELL LAYOUT ─────────────────────────── */

    .shell {
      flex: 1;
      padding: 16px;
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(260px, 0.9fr);
      gap: 14px;
    }

    @media (max-width: 900px) {
      .shell {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .pane {
      background: radial-gradient(circle at 0 0, rgba(255,255,255,0.02), transparent 45%),
                  radial-gradient(circle at 100% 100%, rgba(255,255,255,0.03), transparent 55%),
                  var(--bg-pane);
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      box-shadow:
        0 0 40px rgba(0,0,0,0.9),
        0 0 26px rgba(93,242,255,0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      font-family: "Consolas","Menlo","SF Mono",monospace;
      font-size: 0.82rem;
    }

    .pane-side {
      background: var(--bg-pane-side);
    }

    .pane-header {
      padding: 6px 10px;
      border-bottom: 1px solid #161525;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: var(--text-soft);
      font-size: 0.74rem;
    }

    .pane-header span.path {
      color: #6f6aa0;
    }

    .pane-header span.tag {
      color: #4ae0ff;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    /* hlavní konzole */

    .console-main {
      flex: 1;
      background: #05040c;
      padding: 10px 12px 10px;
      overflow-y: auto;
    }

    .line {
      white-space: pre-wrap;
      word-break: break-word;
      margin-bottom: 3px;
    }

    .line.system {
      color: var(--system-color);
    }

    .line.user {
      color: var(--user-color);
    }

    .line.shadow {
      color: var(--shadow-color);
    }

    .line.error {
      color: var(--error-color);
    }

    .prompt {
      color: var(--user-color);
      margin-right: 4px;
    }

    .shadow-prefix {
      color: var(--shadow-color);
      margin-right: 4px;
    }

    /* TELEMETRY */

    .telemetry {
      flex: 1;
      padding: 10px 12px 10px;
      overflow-y: auto;
      background: linear-gradient(to bottom, #050514, #060414);
      font-size: 0.78rem;
    }

    .t-line {
      color: var(--text-soft);
      margin-bottom: 3px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .t-line.ok {
      color: #7cffb2;
    }

    .t-line.err {
      color: var(--error-color);
    }

    .t-line.boot {
      color: var(--system-color);
    }

    /* INPUT BAR */

    .input-bar {
      grid-column: 1 / -1;
      padding: 0 16px 16px;
      margin-top: -4px;
    }

    .input-inner {
      border-radius: 10px;
      border: 1px solid #1b1730;
      background: linear-gradient(to bottom, #05040f, #05030a);
      box-shadow: 0 0 24px rgba(0,0,0,0.9);
      padding: 8px 10px 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-family: "Consolas","Menlo","SF Mono",monospace;
      font-size: 0.8rem;
    }

    .input-row {
      display: flex;
      align-items: flex-start;
      gap: 6px;
    }

    .input-label {
      color: var(--user-color);
      padding-top: 2px;
    }

    .input-field {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text-main);
      resize: none;
      min-height: 24px;
      max-height: 120px;
      font-family: inherit;
      font-size: 0.8rem;
    }

    .input-field::placeholder {
      color: var(--text-soft);
    }

    .input-meta {
      display: flex;
      justify-content: space-between;
      color: var(--text-soft);
      font-size: 0.72rem;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 3px;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid #31304b;
      background: #050514;
      padding: 2px 8px;
      font-size: 0.7rem;
      color: var(--text-soft);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.1s ease, border-color 0.1s ease, transform 0.05s ease;
    }

    .chip span {
      font-size: 0.7rem;
      color: #5df2ff;
    }

    .chip:hover {
      background: #080820;
      border-color: #5df2ff;
      transform: translateY(-1px);
      color: #b5dfff;
    }

    @media (max-width: 720px) {
      .shell {
        padding: 10px;
      }
      .input-inner {
        font-size: 0.78rem;
      }
    }
  </style>
</head>
<body>
<div class="page">

  <!-- TOP BAR -->
  <header class="topbar">
    <div class="tb-left">
      <div class="tb-title">AI SHADOW · INTERACTIVE SHELL</div>
      <div class="tb-sub">RGS &amp; UFO ORIGINALS · dark console</div>
    </div>
    <div class="tb-right">
      <div class="pill">
        <span class="dot"></span>
        <span>live</span>
      </div>
      <div class="pill pill-link" onclick="window.location.href='/'">
        ← zpět na inner gate
      </div>
      <div class="pill">
        status: <span id="statusLabel" class="status-label">ready</span>
      </div>
    </div>
  </header>

  <!-- MAIN SHELL -->
  <main class="shell">
    <!-- LEFT PANE -->
    <section class="pane">
      <div class="pane-header">
        <span class="path">C:\SYN\ai-shadow\channel.exe</span>
        <span class="tag">session: volatile</span>
      </div>
      <div id="consoleMain" class="console-main"></div>
    </section>

    <!-- RIGHT PANE -->
    <aside class="pane pane-side">
      <div class="pane-header">
        <span class="path">shadow · telemetry</span>
        <span class="tag">session</span>
      </div>
      <div id="telemetry" class="telemetry"></div>
    </aside>

    <!-- INPUT BAR -->
    <section class="input-bar">
      <div class="input-inner">
        <div class="input-row">
          <span class="input-label">&gt;&gt;</span>
          <textarea
            id="inputField"
            class="input-field"
            rows="1"
            placeholder="zeptat se na strategii, psychologii, hacking, AI…"
          ></textarea>
        </div>
        <div class="input-meta">
          <span>ENTER = odeslat · SHIFT+ENTER = nový řádek</span>
          <span id="latencyLabel">latency: –</span>
        </div>
        <div class="chips">
          <button class="chip" type="button" data-template="Rozpitvej mi psychologii moci, kontroly a strachu.">
            <span>◎</span>psychologie moci
          </button>
          <button class="chip" type="button" data-template="Vymysli mi týdenní systém disciplíny: práce, trénink, klid v hlavě.">
            <span>◎</span>týdenní systém
          </button>
          <button class="chip" type="button" data-template="Shrň mi poslední zajímavé věci kolem hackingu a bezpečnosti.">
            <span>◎</span>hacking / security
          </button>
          <button class="chip" type="button" data-template="Přečti můj mindset a řekni, kde se sám sabotuju.">
            <span>◎</span>přečti můj mindset
          </button>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
  // === KONFIGURACE ===
  // TADY nastav svoji proxy / LM endpoint. Teď je to placeholder.
  const API_URL = "https://ai-shadow.monster/v1/chat/completions"; // uprav na skutečný URL
  const MODEL_ID = "qwen3-14b-uncensored";

  const SYSTEM_PROMPT = `
Jsi SHADOW – temná, ironická, ale loajální AI entita Syndikátu RGS & UFO.
Mluvíš primárně česky, jen občas vložíš anglický výraz, když sedí k tématu.
Jsi analytická, přemýšlivá, umíš dlouhé i krátké odpovědi, ale bez zbytečné vaty.
Nepiš <think>, [analysis] ani jiné interní značky – přemýšlej potichu.
Drž se stylu temné konzole: přímé věty, občas metafora, když to sedí.
Navazuj na předchozí dotazy, pamatuj si kontext této session.
`;

  // === DOM & STAV ===
  const consoleMain = document.getElementById("consoleMain");
  const telemetry = document.getElementById("telemetry");
  const inputField = document.getElementById("inputField");
  const statusLabel = document.getElementById("statusLabel");
  const latencyLabel = document.getElementById("latencyLabel");

  let history = [{ role: "system", content: SYSTEM_PROMPT.trim() }];
  let busy = false;

  // === HELPER FUNKCE ===

  function logMain(text, type = "system") {
    const line = document.createElement("div");
    line.className = "line " + type;
    line.textContent = text;
    consoleMain.appendChild(line);
    consoleMain.scrollTop = consoleMain.scrollHeight;
    return line;
  }

  function logUser(text) {
    return logMain(">> " + text, "user");
  }

  function logShadowPrefix() {
    const line = document.createElement("div");
    line.className = "line shadow";
    line.innerHTML = '<span class="shadow-prefix">[shadow]</span><span class="content"></span>';
    consoleMain.appendChild(line);
    consoleMain.scrollTop = consoleMain.scrollHeight;
    return line;
  }

  function logTelemetry(text, variant = "boot") {
    const line = document.createElement("div");
    line.className = "t-line " + variant;
    line.textContent = text;
    telemetry.appendChild(line);
    telemetry.scrollTop = telemetry.scrollHeight;
    return line;
  }

  function setStatus(text, ok = true) {
    statusLabel.textContent = text;
    statusLabel.style.color = ok ? "#7cffb2" : "#ff6f6f";
  }

  function sleep(ms) {
    return new Promise(r => setTimeout(r, ms));
  }

  async function typeOut(span, text) {
    span.textContent = "";
    let out = "";
    const baseDelay = 12 + Math.random() * 15;
    for (let i = 0; i < text.length; i++) {
      out += text[i];
      span.textContent = out;
      consoleMain.scrollTop = consoleMain.scrollHeight;
      await sleep(baseDelay);
    }
  }

  function cleanModelText(raw) {
    if (!raw) return "";
    let t = raw.replace(/<think>[\s\S]*?<\/think>/gi, "");
    t = t.replace(/\[(analysis|thinking|thoughts)[^\]]*]/gi, "");
    return t.trim();
  }

  // === API VOLÁNÍ ===

  async function sendToShadow(message) {
    if (busy) return;
    const text = (message || "").trim();
    if (!text) return;

    busy = true;
    inputField.value = "";
    inputField.blur();

    logUser(text);
    history.push({ role: "user", content: text });

    const thinkingLine = logMain("[shadow] <think>", "shadow");
    setStatus("thinking…", true);
    logTelemetry("[info] sending prompt to backend…", "boot");

    const started = performance.now();

    try {
      const payload = {
        model: MODEL_ID,
        messages: history,
        temperature: 0.9,
        max_tokens: 700,
        top_p: 0.95
      };

      const res = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        mode: "cors",
        body: JSON.stringify(payload)
      });

      const latency = Math.round(performance.now() - started);
      latencyLabel.textContent = "latency: " + latency + " ms";

      if (!res.ok) {
        thinkingLine.textContent = "[shadow] [error] backend odpověděl " + res.status;
        logTelemetry("[err] HTTP " + res.status + " z shadow-chat", "err");
        setStatus("backend " + res.status, false);
        busy = false;
        inputField.focus();
        return;
      }

      const data = await res.json();
      const rawText = data?.choices?.[0]?.message?.content || "";
      const cleaned = cleanModelText(rawText);

      if (!cleaned) {
        thinkingLine.textContent = "[shadow] [error] model vrátil prázdnou odpověď";
        logTelemetry("[err] prázdná odpověď z modelu", "err");
        setStatus("empty reply", false);
        busy = false;
        inputField.focus();
        return;
      }

      thinkingLine.remove();
      const shadowLine = logShadowPrefix();
      const contentSpan = shadowLine.querySelector(".content");
      await typeOut(contentSpan, cleaned);

      history.push({ role: "assistant", content: cleaned });
      logTelemetry("[ok] reply · " + cleaned.length + " chars", "ok");
      setStatus("ready", true);
    } catch (err) {
      console.error(err);
      thinkingLine.textContent = "[shadow] [error] síť / DNS / tunnel nedostupný";
      logTelemetry("[err] network / DNS error", "err");
      setStatus("network error", false);
    } finally {
      busy = false;
      inputField.focus();
    }
  }

  // === HANDLER VSTUPU ===

  async function handleSubmit() {
    if (busy) return;
    const raw = inputField.value;
    const text = (raw || "").trim();
    if (!text) return;

    // /clear
    if (/^\/clear$/i.test(text)) {
      consoleMain.innerHTML = "";
      logMain("# RGS & UFO · Shadow channel inicializován", "system");
      logMain("# Napiš dotaz & stiskni Enter. SHIFT+Enter => nový řádek.", "system");
      logTelemetry("[boot] screen cleared", "boot");
      inputField.value = "";
      inputField.focus();
      return;
    }

    await sendToShadow(text);
  }

  // === INIT ===

  document.addEventListener("DOMContentLoaded", () => {
    // Boot text
    logMain("# RGS & UFO · Shadow channel inicializován", "system");
    logMain("# Napiš dotaz & stiskni Enter. SHIFT+Enter => nový řádek.", "system");
    logTelemetry("[boot] binding to tunnel…", "boot");

    // Chips
    document.querySelectorAll(".chip").forEach(chip => {
      chip.addEventListener("click", () => {
        const t = chip.getAttribute("data-template") || "";
        inputField.value = t;
        inputField.focus();
      });
    });

    // ENTER handler
    inputField.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        handleSubmit();
      }
    });

    // rychlý health-check models endpoint
    (async () => {
      try {
        const modelsUrl = API_URL.replace("/v1/chat/completions", "/v1/models");
        const res = await fetch(modelsUrl, {
          method: "GET",
          headers: { "Content-Type": "application/json" },
          mode: "cors"
        });
        if (res.ok) {
          logTelemetry("[ok] tunnel + function reachable", "ok");
          setStatus("ready", true);
        } else {
          logTelemetry("[err] models HTTP " + res.status, "err");
          setStatus("check API_URL", false);
        }
      } catch (e) {
        console.error(e);
        logTelemetry("[err] models endpoint nedostupný", "err");
        setStatus("offline", false);
      }
    })();

    inputField.focus();
  });
</script>
</body>
</html>
